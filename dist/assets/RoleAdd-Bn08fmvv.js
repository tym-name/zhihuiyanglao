import{m as D,c as F,d as k}from"./role-CUXYcVJy.js";import{d as N,r as u,R as T,k as v,o as B,c as E,e as o,w as n,a as l,h as s,A as K,u as G,Q as g,f as I,b as P,_ as Q}from"./index-D6YPj1KB.js";const S=N({__name:"RoleAdd",setup(U){const w=T(),c=u(Number(w.query.id)||0),i=u(),m=u(),t=v({name:"",id:0,menuIds:[]}),f=u([]),p=u([]),b={label:"name",children:"children"},_=(e,r=0)=>e.filter(a=>a.pid===r).map(a=>{const d=_(e,a.id);return{...a,children:d.length>0?d:[]}}),x=async()=>{try{const e=await D();console.log("权限列表",e),e.data&&e.data.list&&(f.value=e.data.list,p.value=_(f.value))}catch(e){console.error("获取权限列表失败：",e),s.error("加载权限列表失败，请刷新重试")}},C=async()=>{if(c.value)try{const e=await F(c.value);console.log("角色详情",e),e.code===1e4&&e.data?(t.name=e.data.name||"",t.id=e.data.id||0,t.menuIds=e.data.menuIds?Array.isArray(e.data.menuIds)?e.data.menuIds:[e.data.menuIds]:[],K(()=>{m.value&&m.value.setCheckedKeys(t.menuIds)})):s.error("获取角色详情失败")}catch(e){console.error("获取角色详情失败：",e),s.error("加载角色详情失败，请刷新重试")}},R=(e,r)=>{t.menuIds=r.checkedKeys,console.log("选中的权限ID：",t.menuIds)},A=async()=>{if(i.value)try{await i.value.validate();let e;t.id?e=await k(t):e=await k(t),console.log(t.id?"编辑角色":"添加角色",e),e.code===1e4?(s.success(t.id?"编辑成功":"添加成功"),g.push("/role")):s.error(t.id?"编辑失败":"添加失败")}catch(e){console.error("表单提交失败：",e),s.error("操作失败，请检查表单填写是否正确")}},M=v({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],menuIds:[{required:!0,message:"请至少选择一项权限",trigger:"change",validator:(e,r)=>r.length>0}]});return B(async()=>{await x(),c.value&&await C()}),(e,r)=>{const a=l("el-input"),d=l("el-form-item"),V=l("el-tree"),L=l("el-form"),h=l("el-button"),q=l("el-card");return P(),E("div",null,[o(q,null,{default:n(()=>[o(L,{ref_key:"ruleFormRef",ref:i,style:{"max-width":"600px"},model:t,rules:M,"label-width":"auto"},{default:n(()=>[o(d,{label:"角色名称",prop:"name"},{default:n(()=>[o(a,{modelValue:t.name,"onUpdate:modelValue":r[0]||(r[0]=y=>t.name=y),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),o(d,{label:"权限配置",prop:"menuIds"},{default:n(()=>[o(V,{ref_key:"treeRef",ref:m,data:p.value,"show-checkbox":"","node-key":"id","default-expand-all":"",props:b,"checked-keys":t.menuIds,onCheck:R},null,8,["data","checked-keys"])]),_:1})]),_:1},8,["model","rules"]),o(h,{onClick:r[1]||(r[1]=y=>G(g).push("/role"))},{default:n(()=>[...r[2]||(r[2]=[I("关闭",-1)])]),_:1}),o(h,{type:"primary",onClick:A},{default:n(()=>[...r[3]||(r[3]=[I("确定",-1)])]),_:1})]),_:1})])}}}),z=Q(S,[["__scopeId","data-v-5743e52d"]]);export{z as default};
