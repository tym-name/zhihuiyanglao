import{d as q,r as c,o as E,z,k as b,E as i,c as A,e as t,w as o,b as m,f as T,t as V,u as F,A as G,n as R,p as S,g as v,B as _,C as h,a as w,h as j,_ as $}from"./index-DSXWNbz6.js";import{g as J,a as K,b as L,c as P}from"./Outbound-BmmRsxYx.js";const Q={class:"add-goout-page",style:{background:"#f5f5f5","min-height":"100vh"}},W={style:{"font-size":"18px","font-weight":"600","margin-bottom":"20px","padding-bottom":"10px","border-bottom":"1px solid #e4e7ed"}},X=q({__name:"AddOutings",setup(Z){const y=c([]),x=z(),r=c(null),d=c(!1);E(()=>{const e=x.query.id,a=x.query.isEdit;console.log("ddd",e),e&&(r.value=Number(e),d.value=a==="true",d.value?N():Y()),console.log("byId.value",r.value)});const D=b({name:""}),Y=async()=>{if(console.log("byId.value",r.value),!r.value)return;const e=await J(r.value);console.log("详情",e),D.name=e.data.name,l.elderlyName=e.data.name,l.elderlyId=r.value},N=async()=>{if(console.log("byId.value",r.value),!!r.value)try{console.log("获取外出记录详情，ID:",r.value);const e={elderlyId:r.value,elderlyName:"孟北初",startTime:"2025-02-14 19:22:22",endTime:"2025-02-15 19:22:22",accompanyType:"0",name:"孙111222",mobile:"15000000000",address:"沙河",content:"wangyuhao"};console.log("模拟外出记录详情数据:",e),l.elderlyId=e.elderlyId,l.elderlyName=e.elderlyName,l.startTime=e.startTime,l.endTime=e.endTime,l.accompanyType=e.accompanyType,l.name=e.name,l.mobile=e.mobile,l.address=e.address,l.content=e.content,e.startTime&&e.endTime&&(y.value=[e.startTime,e.endTime]),console.log("外出记录详情赋值完成")}catch(e){console.error("获取外出记录详情失败:",e),i.error("获取外出记录详情失败")}},l=b({id:null,elderlyId:"",elderlyName:"",startTime:"",endTime:"",mobile:"",address:"",content:"",relation:"",name:"",accompanyType:""}),k=b({elderlyName:[{required:!0,message:"请先选择外出老人",trigger:"blur"}],name:[{required:!0,message:"请输入陪同人员姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入陪同人员手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式错误",trigger:"blur"}],address:[{required:!0,message:"请输入陪同人员地址",trigger:"blur"}],content:[{required:!0,message:"请输入外出原因",trigger:"blur"}]}),g=c(),I=async()=>{if(!(!g.value||!await g.value.validate())){l.elderlyId=r.value;try{let a;d.value?(a=await K(l),i.success("更新成功")):(a=await L(l),i.success("添加成功")),console.log("444",a),_.push({path:"/care/GoOut"})}catch(a){i.error(d.value?"更新失败":"添加失败"),console.error("保存失败:",a)}}},M=()=>{_.push({path:"/care/GoOut"})},C=async()=>{if(r.value)try{await j.confirm("确定要删除这条外出记录吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await P(r.value),i.success("删除成功"),_.push({path:"/care/GoOut"})}catch(e){e!=="cancel"&&(i.error("删除失败"),console.error("删除失败:",e))}},O=e=>{e&&e.length>1?(l.startTime=e[0]?h(e[0]).format("YYYY-MM-DD HH:mm:ss"):"",l.endTime=e[1]?h(e[1]).format("YYYY-MM-DD HH:mm:ss"):""):(l.startTime="",l.endTime="")};return(e,a)=>{const p=m("el-input"),s=m("el-form-item"),B=m("el-date-picker"),u=m("el-option"),H=m("el-select"),f=m("el-button"),U=m("el-card");return w(),A("div",Q,[t(U,{style:{"max-width":"100%",margin:"0 auto"}},{default:o(()=>[T("div",W,V(d.value?"编辑外出登记":"新增外出登记"),1),t(F(G),{ref_key:"goOutFormRef",ref:g,model:l,"label-width":"140px",rules:k,style:{padding:"10px"}},{default:o(()=>[t(s,{label:"外出老人",prop:"elderlyName",style:{"max-width":"460px"}},{default:o(()=>[t(p,{modelValue:l.elderlyName,"onUpdate:modelValue":a[0]||(a[0]=n=>l.elderlyName=n),disabled:"",readonly:"",placeholder:"请选择外出老人"},null,8,["modelValue"])]),_:1}),t(s,{label:"外出时间",prop:"outTime",style:{"max-width":"460px"}},{default:o(()=>[t(B,{type:"datetimerange","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"},onChange:O,modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=n=>y.value=n)},null,8,["modelValue"])]),_:1}),t(s,{label:"陪同人员类型",prop:"accompanyType",style:{"max-width":"460px"}},{default:o(()=>[t(H,{modelValue:l.accompanyType,"onUpdate:modelValue":a[2]||(a[2]=n=>l.accompanyType=n),placeholder:"请选择"},{default:o(()=>[t(u,{label:"母女",value:"0"}),t(u,{label:"兄弟",value:"1"}),t(u,{label:"姐妹",value:"2"}),t(u,{label:"朋友",value:"3"}),t(u,{label:"其他",value:"4"}),t(u,{label:"本人",value:"5"}),t(u,{label:"护理人员",value:"6"})]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"陪同人员姓名",prop:"name",style:{"max-width":"460px"}},{default:o(()=>[t(p,{modelValue:l.name,"onUpdate:modelValue":a[3]||(a[3]=n=>l.name=n),placeholder:"请输入"},null,8,["modelValue"])]),_:1}),t(s,{label:"陪同人员电话",prop:"mobile",style:{"max-width":"460px"}},{default:o(()=>[t(p,{placeholder:"请输入",modelValue:l.mobile,"onUpdate:modelValue":a[4]||(a[4]=n=>l.mobile=n)},null,8,["modelValue"])]),_:1}),t(s,{label:"陪同人员地址",prop:"address",style:{"max-width":"460px"}},{default:o(()=>[t(p,{placeholder:"请输入",modelValue:l.address,"onUpdate:modelValue":a[5]||(a[5]=n=>l.address=n)},null,8,["modelValue"])]),_:1}),t(s,{label:"外出原因",prop:"content",style:{"max-width":"460px"}},{default:o(()=>[t(p,{type:"textarea",placeholder:"请输入",modelValue:l.content,"onUpdate:modelValue":a[6]||(a[6]=n=>l.content=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),T("div",null,[t(s,{style:{"text-align":"center","margin-top":"10px"}},{default:o(()=>[t(f,{type:"primary",size:"large",onClick:I},{default:o(()=>[v(V(d.value?"保存修改":"保存"),1)]),_:1}),t(f,{size:"large",style:{"margin-left":"20px"},onClick:M},{default:o(()=>[...a[7]||(a[7]=[v("取消",-1)])]),_:1}),d.value?(w(),R(f,{key:0,type:"danger",size:"large",style:{"margin-left":"20px"},onClick:C},{default:o(()=>[...a[8]||(a[8]=[v("删除",-1)])]),_:1})):S("",!0)]),_:1})])]),_:1})])}}}),ae=$(X,[["__scopeId","data-v-09ae58c4"]]);export{ae as default};
