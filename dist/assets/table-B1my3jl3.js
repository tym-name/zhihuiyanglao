import{d as F,r as h,k as H,j as k,o as L,c as m,n as c,p as _,e as C,w as i,a as d,B as b,C as R,g as q,D as E,F as G,x as A,a5 as J,b as r,G as K,f as O,v as Q,a6 as X,_ as Z}from"./index-D6YPj1KB.js";const ee={class:"table-container"},te={key:0,class:"table-actions"},ae={key:1},se={class:"pagination-wrapper"},re=F({__name:"table",props:{columns:{default:()=>[]},hasSearch:{type:Boolean,default:!0},width:{default:"100%"},pageSizes:{default:()=>[10,20,50,100]},initParams:{default:()=>({})},fetchData:{},showSelectionColumn:{type:Boolean,default:!1},autoInit:{type:Boolean,default:!0}},emits:["selection-change","load-success","load-fail"],setup(u,{expose:x,emit:D}){const o=u,v=D,w=h(),y=h(!1),p=h([]),g=h(0),s=H({currentPage:1,pageSize:o.pageSizes[0]}),P=k(()=>o.width==="100%"?"100%":`${o.width}px`),B=k(()=>({page:s.currentPage,pageSize:s.pageSize,...o.initParams})),T=(e,a="YYYY-MM-DD HH:mm:ss")=>{if(!e)return"-";try{return X(e).format(a)}catch(f){return console.warn("时间格式化失败:",f),"-"}},S=e=>e?e.startsWith("http")||e.startsWith("//")?e:"http://123.57.237.81:8080/caresystem/"+e:"",l=async(e=!1)=>{e&&(s.currentPage=1),y.value=!0;try{const a=await o.fetchData({...B.value});p.value=a.data.list||[],g.value=a.data.counts||0,v("load-success",p.value)}catch(a){console.error("表格数据加载失败:",a),p.value=[],g.value=0,v("load-fail",a)}finally{y.value=!1}},$=()=>l(!0),I=()=>{w.value?.clearSelection()},N=e=>{s.pageSize=e,l()},V=e=>{s.currentPage=e,l()},W=e=>{v("selection-change",e)};return L(()=>{o.autoInit&&l()}),x({refresh:$,getData:l,clearSelection:I,tableRef:w}),(e,a)=>{const f=d("el-card"),z=d("el-table-column"),Y=d("el-image"),j=d("el-table"),M=d("el-pagination"),U=E("loading");return r(),m("div",ee,[e.$slots.search?(r(),c(f,{key:0,class:"search-card",shadow:"never"},{default:i(()=>[b(e.$slots,"search",{},void 0,!0)]),_:3})):_("",!0),C(f,{class:"table-card",shadow:"never"},{default:i(()=>[e.$slots.buttons?(r(),m("div",te,[b(e.$slots,"buttons",{},void 0,!0)])):_("",!0),R((r(),c(j,{ref_key:"tableRef",ref:w,onSelectionChange:W,data:p.value,style:J({width:P.value}),stripe:""},{default:i(()=>[u.showSelectionColumn?(r(),c(z,{key:0,type:"selection",width:"55",fixed:"left"})):_("",!0),(r(!0),m(G,null,A(u.columns,t=>(r(),c(z,{key:t.prop||t.label,type:t.type,fixed:t.fixed,prop:t.prop,label:t.label,width:t.width,"min-width":t.minWidth,align:t.align||"center"},K({_:2},[t.slot?{name:"default",fn:i(n=>[b(e.$slots,t.slot,{row:n.row,index:n.index},void 0,!0)]),key:"0"}:t.formatTime?{name:"default",fn:i(n=>[O(Q(T(n.row[t.prop],t.formatTime)),1)]),key:"1"}:t.image?{name:"default",fn:i(n=>[n.row[t.image]?(r(),c(Y,{key:0,"preview-teleported":"",class:"table-image",src:S(n.row[t.image]),"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[S(n.row[t.image])],"show-progress":"",fit:"cover"},null,8,["src","preview-src-list"])):(r(),m("span",ae,"暂无图片"))]),key:"2"}:void 0]),1032,["type","fixed","prop","label","width","min-width","align"]))),128))]),_:3},8,["data","style"])),[[U,y.value]]),q("div",se,[C(M,{"current-page":s.currentPage,"onUpdate:currentPage":a[0]||(a[0]=t=>s.currentPage=t),"page-size":s.pageSize,"onUpdate:pageSize":a[1]||(a[1]=t=>s.pageSize=t),"page-sizes":u.pageSizes,total:g.value,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:V,disabled:g.value===0},null,8,["current-page","page-size","page-sizes","total","disabled"])])]),_:3})])}}}),oe=Z(re,[["__scopeId","data-v-d71c418c"]]);export{oe as T};
