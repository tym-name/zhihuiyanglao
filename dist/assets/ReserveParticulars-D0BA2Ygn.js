import{u as P}from"./Uploads-hqb4toZy.js";import{c as T}from"./Reserve-s3Ful1lR.js";import{d as A,r as v,z as L,k as V,j as W,o as j,c,e,w as t,b as d,E as h,f as o,t as i,u as G,g as k,F as S,v as $,M as z,a as f,_ as H}from"./index-DSXWNbz6.js";const J={class:"reservation-page"},K={class:"form-section"},O={class:"form-section"},Q={key:0,class:"image-preview-container"},X=["src","onClick"],Y={key:1,class:"no-image-tip"},Z={class:"form-actions"},ee=["src"],te=A({__name:"ReserveParticulars",setup(ae){const x="http://123.57.237.81:8080/caresystem-server/api",b="http://123.57.237.81:8080/caresystem/",D=x+"/upload/add",m=v(""),p=L(),N=z();console.log("路由信息：",p);const q=V({name:[{required:!0,message:"请输入预定人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入预定人电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号",trigger:"blur"}],relation:[{required:!0,message:"请选择与老人关系",trigger:"change"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}],days:[{required:!0,message:"请输入预定时长",trigger:"blur"},{type:"number",min:1,message:"时长不能小于1天",trigger:"blur"}],amount:[{required:!0,message:"请输入定金金额",trigger:"blur"},{type:"number",min:0,message:"定金不能为负数",trigger:"blur"}]}),s=V({id:0,elderlyId:0,name:"",mobile:"",relation:"",bed:"",startDate:"",day:0,amount:0,files:[]}),_=v(),I=W(()=>m.value?m.value.split(",").filter(r=>r.trim()).map(r=>r.startsWith("http")?r:b+r):[]),y=v(!1),w=v(""),C=r=>{w.value=r,y.value=!0},U=async()=>{try{const r=p.query.id||p.params.id;if(!r){h.warning("未找到有效的记录ID");return}console.log("id",r);const l=await T(Number(r));if(console.log("单条预订信息",l),l.code===1e4&&l.data){const a=l.data;s.id=a.id,s.bed=a.bed||"",s.elderlyId=a.elderlyId||0,s.name=a.name||"",s.mobile=a.mobile||"",s.relation=a.relation||"",s.startDate=a.startDate||"",s.day=a.day||0,s.amount=a.amount||0,s.files=a.files||[],a.files&&a.files.length>0&&(m.value=a.files.map(n=>n.file.startsWith("http")?n.file:b+n.file).join(","),_.value&&typeof _.value.initFiles=="function"&&_.value.initFiles(a.files))}else h.error("获取预定信息失败："+(l.msg||"未知错误"))}catch(r){console.error("获取预定详情失败：",r),h.error("获取预定详情失败，请刷新重试")}};j(()=>{const r=p.query.elderlyId||p.params.elderlyId;if(console.log("老人id",r),r){const l=Array.isArray(r)?Number(r[0]):Number(r);isNaN(l)||(s.elderlyId=l)}U()});const E=()=>{N.push({path:"/Reserve"})};return(r,l)=>{const a=d("el-form-item"),n=d("el-col"),g=d("el-row"),R=d("el-button"),F=d("el-form"),B=d("el-dialog");return f(),c("div",J,[e(F,{ref:"formRef",model:s,rules:q,"label-width":"150px",class:"reservation-form"},{default:t(()=>[o("div",K,[l[2]||(l[2]=o("h3",{class:"section-title"},"预定信息",-1)),e(g,{gutter:20},{default:t(()=>[e(n,{span:12},{default:t(()=>[e(a,{label:"预定人姓名:",prop:"name"},{default:t(()=>[o("div",null,i(s.name),1)]),_:1})]),_:1}),e(n,{span:12},{default:t(()=>[e(a,{label:"预定人电话:",prop:"mobile"},{default:t(()=>[o("div",null,i(s.mobile),1)]),_:1})]),_:1})]),_:1}),e(g,{gutter:20},{default:t(()=>[e(n,{span:12},{default:t(()=>[e(a,{label:"与老人关系:",prop:"relation"},{default:t(()=>[o("div",null,i(s.relation),1)]),_:1})]),_:1}),e(n,{span:12},{default:t(()=>[e(a,{label:"床位",prop:"bed"},{default:t(()=>[o("div",null,i(s.bed),1)]),_:1})]),_:1})]),_:1}),e(g,{gutter:20},{default:t(()=>[e(n,{span:12},{default:t(()=>[e(a,{label:"开始日期:",prop:"startDate"},{default:t(()=>[o("div",null,i(s.startDate),1)]),_:1})]),_:1}),e(n,{span:12},{default:t(()=>[e(a,{label:"预定时长（天）:",prop:"day"},{default:t(()=>[o("div",null,i(s.day),1)]),_:1})]),_:1})]),_:1}),e(g,{gutter:20},{default:t(()=>[e(n,{span:12},{default:t(()=>[e(a,{label:"定金应收:",prop:"amount"},{default:t(()=>[o("div",null,i(s.amount),1)]),_:1})]),_:1})]),_:1})]),o("div",O,[l[4]||(l[4]=o("h3",{class:"section-title"},"预定协议",-1)),e(a,{class:"FormWraps",label:"上传图片"},{default:t(()=>[e(P,{ref_key:"uploadRef",ref:_,modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=u=>m.value=u),baseUrl:G(b),uploadUrl:D,isText:!0},{"upload-text":t(()=>[e(R,{type:"primary"},{default:t(()=>[...l[3]||(l[3]=[k("上传图片",-1)])]),_:1})]),_:1},8,["modelValue","baseUrl"]),I.value.length>0?(f(),c("div",Q,[(f(!0),c(S,null,$(I.value,(u,M)=>(f(),c("img",{key:M,src:u,alt:"预定协议图片",class:"preview-img",onClick:le=>C(u)},null,8,X))),128))])):(f(),c("div",Y,"暂无上传的协议图片"))]),_:1})]),o("div",Z,[e(R,{onClick:E},{default:t(()=>[...l[5]||(l[5]=[k("返回",-1)])]),_:1})])]),_:1},8,["model","rules"]),e(B,{modelValue:y.value,"onUpdate:modelValue":l[1]||(l[1]=u=>y.value=u),title:"图片预览",width:"80%","append-to-body":""},{default:t(()=>[o("img",{src:w.value,class:"preview-big-img",style:{width:"100px",height:"200px"}},null,8,ee)]),_:1},8,["modelValue"])])}}}),ne=H(te,[["__scopeId","data-v-a3949def"]]);export{ne as default};
