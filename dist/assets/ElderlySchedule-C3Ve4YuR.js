import{n as Y,i as D,j as ee,k as te}from"./elderly-p1gfo6w8.js";import{d as le,r as f,k as A,o as oe,z as ne,E as b,n as G,w as a,b as T,f as o,e as d,g as y,c as r,F as _,v as g,t as k,Z as U,h as re,a as n,_ as se}from"./index-DSXWNbz6.js";const ie={class:"cycle-tabs"},ae={class:"tab-content"},ue={key:0},de={class:"time-label"},ce={class:"time-content"},me={class:"task-content"},ve=["onClick"],pe={key:1},fe={class:"week-header"},ye={class:"time-label"},_e={class:"week-content"},ge={class:"task-content"},ke=["onClick"],Te={key:2},we={class:"month-pagination"},be={class:"month-header"},$e={class:"time-label"},he={class:"month-content"},Ce={class:"task-content"},Se=["onClick"],xe={class:"task-time-container"},Ve={class:"dialog-footer"},je=le({__name:"ElderlySchedule",setup(He){const j=f("day"),C=f(["上午00时","上午01时","上午02时","上午03时","上午04时","上午05时","上午06时","上午07时","上午08时","上午09时","上午10时","上午11时","下午12时","下午13时","下午14时","下午15时","下午16时","下午17时","下午18时","下午19时","下午20时","下午21时","下午22时","下午23时"]),H=f(["周一","周二","周三","周四","周五","周六","周日"]),S=f([1,2,3,4,5,6,7,8,9,10]),I=f(1),O=f([]),Z=ne(),P=f(0),x=f(!1),c=A({serviceProject:"",time:[null,null],startTime:"",endTime:""}),J=f(""),K=f(void 0),R=l=>{const e=l.match(/\d+/);if(!e)return 0;const s=e[0];return parseInt(s,10)},Q=l=>l>=0&&l<12?`上午${l.toString().padStart(2,"0")}时`:`下午${l.toString().padStart(2,"0")}时`,p=A({});for(const l of C.value){p[l]=[];for(const e of H.value)p[`${l}-${e}`]=[];for(let e=1;e<=31;e++)p[`${l}-${e}`]=[]}const z=(l,e)=>{const s=(l.startHour-e)*60+l.startMinute,i=(l.endHour-l.startHour)*60+(l.endMinute-l.startMinute)+"px",$=s+"px";return{height:i,top:$,position:"absolute",left:"5px",right:"5px",backgroundColor:"#409eff",color:"white",borderRadius:"4px",padding:"5px",fontSize:"12px",textAlign:"center",zIndex:2,cursor:"pointer"}},E=l=>{I.value=l,l===1?S.value=[1,2,3,4,5,6,7,8,9,10]:l===2?S.value=[11,12,13,14,15,16,17,18,19,20]:l===3&&(S.value=[21,22,23,24,25,26,27,28,29,30,31])},N=async(l,e)=>{J.value=l,K.value=e,c.serviceProject="",c.time=[null,null],x.value=!0};oe(async()=>{let l=f({page:1,pageSize:1e3}),e=await Y(l.value);O.value=e.data.list,L()});const W=async()=>{if(!c.serviceProject){b.warning("请选择服务项目");return}if(!c.time[0]){b.warning("请选择开始时间");return}if(!c.time[1]){b.warning("请选择结束时间");return}const l=m=>{const[i,$]=m.split(":").map(Number);return{hour:i,minute:$}},e=l(c.time[0]),s=l(c.time[1]);if(e.hour>s.hour||e.hour===s.hour&&e.minute>s.minute){b.warning("开始时间不能晚于结束时间");return}try{const m={day:"",elderlyId:P.value,endTime:c.time[1],serviceId:c.serviceProject,startTime:c.time[0],time:[new Date().toISOString(),new Date().toISOString()]};let i=await ee(m);console.log("添加任务结果:",i),x.value=!1,await L(),b.success("任务添加成功")}catch(m){console.error("添加任务失败:",m),b.error("添加任务失败")}},B=async l=>{try{await re.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await te(Number(l.id)),b.success("任务删除成功"),await L()}catch(e){e!=="cancel"&&(console.error("删除任务失败:",e),b.error("删除任务失败"))}},L=async()=>{try{P.value=Number(Z.query.id);let l=await D(P.value);for(const e of C.value){p[e]=[];for(const s of H.value)p[`${e}-${s}`]=[];for(let s=1;s<=31;s++)p[`${e}-${s}`]=[]}l.data.list.forEach(e=>{const s=w=>{const[h,t]=w.split(":").slice(0,2).map(Number);return{hour:h,minute:t}},m=s(e.startTime),i=s(e.endTime),$=w=>w.slice(0,5),M=$(e.startTime),V=$(e.endTime),q=`${M}-${V}`,F={id:e.id.toString(),serviceProject:e.serviceName,timeRange:q,startTime:M,endTime:V,startHour:m.hour,endHour:i.hour,startMinute:m.minute,endMinute:i.minute,duration:(i.hour-m.hour)*60+(i.minute-m.minute)};for(let w=m.hour;w<=i.hour;w++){const h=Q(w);let t="";if(e.type==="日循环")t=h;else if(e.type==="周循环")t=`${h}-${e.week}`;else if(e.type==="月循环"){let u=1;e.week&&e.week.includes("号")?u=parseInt(e.week.replace("号","")):typeof e.day=="string"&&e.day&&(u=parseInt(e.day)),t=`${h}-${u}`}p[t]&&p[t].push(F)}})}catch(l){console.error("获取老人任务数据失败:",l),b.error("获取老人任务数据失败")}};return(l,e)=>{const s=T("el-radio"),m=T("el-radio-group"),i=T("el-button"),$=T("el-option"),M=T("el-select"),V=T("el-form-item"),q=T("el-time-picker"),F=T("el-form"),w=T("el-dialog"),h=T("el-card");return n(),G(h,null,{default:a(()=>[e[21]||(e[21]=o("div",null,"计划任务",-1)),o("div",ie,[d(m,{modelValue:j.value,"onUpdate:modelValue":e[0]||(e[0]=t=>j.value=t),class:"radio-group"},{default:a(()=>[d(s,{label:"day",class:"radio-item"},{default:a(()=>[...e[8]||(e[8]=[y("日循环",-1)])]),_:1}),d(s,{label:"week",class:"radio-item"},{default:a(()=>[...e[9]||(e[9]=[y("周循环",-1)])]),_:1}),d(s,{label:"month",class:"radio-item"},{default:a(()=>[...e[10]||(e[10]=[y("月循环",-1)])]),_:1})]),_:1},8,["modelValue"]),o("div",ae,[j.value==="day"?(n(),r("div",ue,[(n(!0),r(_,null,g(C.value,t=>(n(),r("div",{key:t,class:"time-item"},[o("div",de,k(t),1),o("div",ce,[(n(!0),r(_,null,g(p[t],u=>(n(),r("div",{key:u.id,style:U(z(u,R(t))),class:"task-item-container"},[o("div",me,[o("div",null,k(u.serviceProject),1),o("div",null,k(u.timeRange),1)]),o("div",{class:"task-delete",onClick:v=>B(u)},"×",8,ve)],4))),128)),d(i,{type:"primary",size:"small",plain:"",onClick:u=>N(t)},{default:a(()=>[...e[11]||(e[11]=[y(" + 添加任务 ",-1)])]),_:1},8,["onClick"])])]))),128))])):j.value==="week"?(n(),r("div",pe,[o("div",fe,[e[12]||(e[12]=o("div",{class:"time-label"},null,-1)),(n(!0),r(_,null,g(H.value,t=>(n(),r("div",{class:"week-day",key:t},k(t),1))),128))]),(n(!0),r(_,null,g(C.value,t=>(n(),r("div",{key:t,class:"time-item"},[o("div",ye,k(t),1),o("div",_e,[(n(!0),r(_,null,g(H.value,u=>(n(),r("div",{key:u,class:"week-day-cell"},[(n(!0),r(_,null,g(p[t+"-"+u],v=>(n(),r("div",{key:v.id,style:U(z(v,R(t))),class:"task-item-container"},[o("div",ge,[o("div",null,k(v.serviceProject),1),o("div",null,k(v.timeRange),1)]),o("div",{class:"task-delete",onClick:X=>B(v)},"×",8,ke)],4))),128)),d(i,{type:"primary",size:"small",plain:"",onClick:v=>N(t,u)},{default:a(()=>[...e[13]||(e[13]=[y(" + 添加任务 ",-1)])]),_:1},8,["onClick"])]))),128))])]))),128))])):(n(),r("div",Te,[o("div",we,[d(i,{type:I.value===1?"primary":"default",onClick:e[1]||(e[1]=t=>E(1))},{default:a(()=>[...e[14]||(e[14]=[y("1-10号",-1)])]),_:1},8,["type"]),d(i,{type:I.value===2?"primary":"default",onClick:e[2]||(e[2]=t=>E(2))},{default:a(()=>[...e[15]||(e[15]=[y("11-20号",-1)])]),_:1},8,["type"]),d(i,{type:I.value===3?"primary":"default",onClick:e[3]||(e[3]=t=>E(3))},{default:a(()=>[...e[16]||(e[16]=[y("21-31号",-1)])]),_:1},8,["type"])]),o("div",be,[e[17]||(e[17]=o("div",{class:"time-label"},null,-1)),(n(!0),r(_,null,g(S.value,t=>(n(),r("div",{class:"month-day",key:t},k(t)+"号",1))),128))]),(n(!0),r(_,null,g(C.value,t=>(n(),r("div",{key:t,class:"time-item"},[o("div",$e,k(t),1),o("div",he,[(n(!0),r(_,null,g(S.value,u=>(n(),r("div",{key:u,class:"month-day-cell"},[(n(!0),r(_,null,g(p[t+"-"+u],v=>(n(),r("div",{key:v.id,style:U(z(v,R(t))),class:"task-item-container"},[o("div",Ce,[o("div",null,k(v.serviceProject),1),o("div",null,k(v.timeRange),1)]),o("div",{class:"task-delete",onClick:X=>B(v)},"×",8,Se)],4))),128)),d(i,{type:"primary",size:"small",plain:"",onClick:v=>N(t,u)},{default:a(()=>[...e[18]||(e[18]=[y(" + 添加任务 ",-1)])]),_:1},8,["onClick"])]))),128))])]))),128))]))]),d(w,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=t=>x.value=t),title:"添加任务",width:"500px"},{footer:a(()=>[o("span",Ve,[d(i,{onClick:e[6]||(e[6]=t=>x.value=!1)},{default:a(()=>[...e[19]||(e[19]=[y("取消",-1)])]),_:1}),d(i,{type:"primary",onClick:W},{default:a(()=>[...e[20]||(e[20]=[y("确定",-1)])]),_:1})])]),default:a(()=>[d(F,{model:c,inline:!0},{default:a(()=>[d(V,{label:"服务项目",required:""},{default:a(()=>[d(M,{modelValue:c.serviceProject,"onUpdate:modelValue":e[4]||(e[4]=t=>c.serviceProject=t),placeholder:"请选择服务项目",style:{width:"400px"}},{default:a(()=>[(n(!0),r(_,null,g(O.value,t=>(n(),G($,{label:t.name,value:t.id},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),d(V,{label:"任务时间",required:""},{default:a(()=>[o("div",xe,[d(q,{modelValue:c.time,"onUpdate:modelValue":e[5]||(e[5]=t=>c.time=t),"is-range":"","range-separator":"To","start-placeholder":"开始时间","end-placeholder":"结束时间",style:{width:"340px"},"value-format":"HH:mm",format:"HH:mm"},null,8,["modelValue"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1})}}}),Pe=se(je,[["__scopeId","data-v-25281705"]]);export{Pe as default};
