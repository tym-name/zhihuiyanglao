import{d as R,r as _,k as E,j as S,b as i,c as q,a as z,e as t,w as o,g as b,f as k,t as G,ae as w,u as C,y as H,af as J,L as K,F as Q,E as v,h as W,_ as X}from"./index-DSXWNbz6.js";import{d as Y,a as Z,b as ee,c as ae}from"./personel-C8BKxqDq.js";const te={class:"custom-tree-node"},le={class:"node-label"},ne={class:"node-actions"},oe=R({__name:"Department",setup(se){const F=e=>{console.log(e)},V=_([]),D={children:"children",label:"label"},s=E({id:0,companyId:0,name:"",pid:0}),r=_(!1),u=_(!1),g=_(null),B=S(()=>u.value?"编辑部门":"添加部门"),I=e=>{const a=new Map,l=[];return e.forEach(n=>{a.set(n.id,{label:n.name,children:[],original:n})}),e.forEach(n=>{const c=a.get(n.id);if(c&&n.pid){const d=a.get(n.pid);d?(d.children||(d.children=[]),d.children.push(c)):l.push(c)}else l.push(c)}),l},h=async()=>{try{const e=await Y({});V.value=I(e.data.list)}catch(e){console.error("获取部门列表失败:",e),v.error("获取部门列表失败")}};h();const m=_(),M=E({name:{required:!0,message:"请输入部门名称",trigger:"blur"}}),N=()=>{p(),u.value=!1,g.value=null,r.value=!0},T=e=>{p(),u.value=!1,g.value=e,s.pid=e.id,r.value=!0},$=e=>{p(),u.value=!0,g.value=null,Object.assign(s,{id:e.id,companyId:e.companyId,name:e.name,pid:e.pid}),r.value=!0},j=async e=>{try{await W.confirm(`确定要删除部门 "${e.name}" 吗？删除后无法恢复！`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Z(e.id),await h(),v.success("部门删除成功")}catch(a){a!=="cancel"&&(console.error("删除部门失败:",a),v.error("删除部门失败"))}},A=async()=>{!m.value||!await m.value.validate()||(u.value?(await ee(s),v.success("部门更新成功")):(await ae(s),v.success("部门添加成功")),r.value=!1,await h(),p())},L=()=>{r.value=!1,p()},p=()=>{Object.assign(s,{id:0,companyId:0,name:"",pid:g.value?.pid||0}),m.value&&m.value.clearValidate()};return(e,a)=>{const l=i("el-button"),n=i("el-tree"),c=i("el-card"),d=i("el-input"),U=i("el-form-item"),O=i("el-form"),P=i("el-dialog");return z(),q(Q,null,[t(c,null,{default:o(()=>[t(l,{type:"success",onClick:N},{default:o(()=>[...a[2]||(a[2]=[b("添加部门",-1)])]),_:1}),t(n,{"show-checkbox":"",data:V.value,props:D,onNodeClick:F,style:{"max-width":"400px"},class:"department-tree"},{default:o(({node:f,data:y})=>[k("div",te,[k("span",le,G(f.label),1),k("div",ne,[t(l,{type:"success",circle:"",icon:C(H),onClick:w(x=>T(y.original),["stop"])},null,8,["icon","onClick"]),t(l,{type:"primary",icon:C(J),circle:"",onClick:w(x=>$(y.original),["stop"])},null,8,["icon","onClick"]),t(l,{type:"danger",icon:C(K),circle:"",onClick:w(x=>j(y.original),["stop"])},null,8,["icon","onClick"])])])]),_:1},8,["data"])]),_:1}),t(P,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=f=>r.value=f),title:B.value},{footer:o(()=>[t(l,{onClick:L},{default:o(()=>[...a[3]||(a[3]=[b("取消",-1)])]),_:1}),t(l,{type:"primary",onClick:A},{default:o(()=>[...a[4]||(a[4]=[b(" 提交 ",-1)])]),_:1})]),default:o(()=>[t(O,{ref_key:"ruleFormRef",ref:m,model:s,rules:M,"label-width":"auto"},{default:o(()=>[t(U,{label:"名称",prop:"name"},{default:o(()=>[t(d,{modelValue:s.name,"onUpdate:modelValue":a[0]||(a[0]=f=>s.name=f)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}}),ce=X(oe,[["__scopeId","data-v-7afa0376"]]);export{ce as default};
