import{T as ee}from"./table-BDVlGf5e.js";import{s as le}from"./staff-DkaIM1g7.js";import{d as te,a as ae,e as ne,f as oe}from"./personel-C8BKxqDq.js";import{r as de}from"./position-BwEY5D3f.js";import{d as re,k as _,r as c,b as m,c as y,a as p,e as t,w as a,F as V,v as k,n as T,g as r,t as F,f as se,u as ue,h as B,E as b,B as E}from"./index-DSXWNbz6.js";const ie=["src"],me="http://123.57.237.81:8080/caresystem/",Ve=re({__name:"Staff",setup(pe){const o=_({id:0,companyId:0,photo:"",name:"",mobile:"",isCarer:0,departmentId:0,addAccountId:0,addAccountName:"",addTime:"",departmentName:"",roles:[{id:0,name:"",companyId:0,addAccountId:0,addAccountName:null,addTime:"",accountCounts:0,menuIds:null}],adminId:0,adminUserName:"",adminPwd:"",enable:"",idCard:""}),L=[{type:"selection",width:"50"},{label:"序号",prop:"id",width:"100px"},{label:"头像",slot:"photo"},{label:"姓名",prop:"name"},{label:"联系方式",prop:"mobile"},{label:"身份证号",prop:"idCard"},{label:"所属部门",prop:"departmentName"},{label:"所属岗位",slot:"name"},{label:"账号",prop:"adminUserName"},{label:"创建人",prop:"addAccountName"},{label:"是否禁用",slot:"enable"},{label:"操作",slot:"operate",width:300,fixed:"right"}],$=_({id:0,companyId:0,name:"",pid:0}),N=c([]);(async()=>{const n=await te($);console.log("所属部门",n),N.value=n.data.list})();const U=c([]),R=_({id:0,name:"",companyId:0,addAccountId:0,addAccountName:"",addTime:"",accountCounts:0,menuIds:[]});(async()=>{const n=await de(R);console.log("所属岗位",n),U.value=n.data.list})();const S=[{value:"未解决"},{value:"已解决"}],f=c(null),D=async n=>{B.confirm("是否删除该条记录？",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{b({type:"success",message:"删除成功"}),await ae(n),f.value?.refresh()}).catch(()=>{b({type:"info",message:"已取消删除"})})},w=c([]),j=n=>{w.value=n.map(e=>e.id)},M=async()=>{w.value.length!==0&&(await B.confirm(`确定删除这${w.value.length}项数据吗? 删除后无法恢复`,"警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await ne(w.value),w.value=[],f.value?.refresh(),b.success("删除成功"))},q=async()=>{b.success("取消成功"),f.value?.refresh()},z=async()=>{b.success("禁用成功"),f.value?.refresh()},Z=()=>{E.push("/staff-add")},G=n=>{E.push(`/staff-edit/${n}`)},v=c(!1),x=c(),i=_({newPwd:"",confirmPwd:""}),C=c(null),O=(n,e,d)=>{e?e.length<6?d(new Error("密码长度不能少于6位")):e.length>20?d(new Error("密码长度不能超过20位")):/^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d@$!%*?&.,<>{}[\]|;':\"`~()]+$/.test(e)?d():d(new Error("密码必须包含字母和数字")):d(new Error("请输入新密码"))},H=(n,e,d)=>{e?e!==i.newPwd?d(new Error("两次输入的密码不一致")):d():d(new Error("请再次输入新密码"))},J=async n=>{C.value=n,i.newPwd="",i.confirmPwd="",v.value=!0},K=async n=>{n&&await n.validate(async e=>{if(e&&C.value)try{await oe({id:C.value.id,pwd:i.newPwd}),b.success("密码重置成功"),v.value=!1,n.resetFields(),f.value?.refresh()}catch{b.error("密码重置失败，请重试")}})},Q=n=>{n&&(n.resetFields(),v.value=!1)},h=()=>{const n={name:o.name,mobile:o.mobile,idCard:o.idCard,departmentId:o.departmentName,enable:o.enable==="未解决"?0:o.enable==="已解决"?1:"",roleIds:o.roles?[o.roles]:[]};f.value?.refresh(n)},W=()=>{Object.assign(o,{name:"",mobile:"",idCard:"",departmentName:"",enable:"",roles:[]}),h()};return(n,e)=>{const d=m("el-input"),u=m("el-form-item"),I=m("el-option"),P=m("el-select"),s=m("el-button"),A=m("el-form"),X=m("el-card"),Y=m("el-dialog");return p(),y(V,null,[t(X,{style:{"margin-bottom":"10px"}},{default:a(()=>[t(A,{model:o,"label-width":"auto",inline:""},{default:a(()=>[t(u,{label:"员工姓名:"},{default:a(()=>[t(d,{modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l),clearable:"",placeholder:"请输入员工姓名",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"联系方式:"},{default:a(()=>[t(d,{modelValue:o.mobile,"onUpdate:modelValue":e[1]||(e[1]=l=>o.mobile=l),clearable:"",placeholder:"请输入联系方式",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"身份证号:"},{default:a(()=>[t(d,{modelValue:o.idCard,"onUpdate:modelValue":e[2]||(e[2]=l=>o.idCard=l),clearable:"",placeholder:"请输入身份证号",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"所属部门"},{default:a(()=>[t(P,{modelValue:o.departmentName,"onUpdate:modelValue":e[3]||(e[3]=l=>o.departmentName=l),placeholder:"请选择部门",clearable:"",style:{width:"180px"}},{default:a(()=>[(p(!0),y(V,null,k(N.value,l=>(p(),T(I,{key:l,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"所属岗位"},{default:a(()=>[t(P,{modelValue:o.roles,"onUpdate:modelValue":e[4]||(e[4]=l=>o.roles=l),placeholder:"请选择岗位",clearable:"",style:{width:"180px"}},{default:a(()=>[(p(!0),y(V,null,k(U.value,l=>(p(),T(I,{key:l,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"状态"},{default:a(()=>[t(P,{modelValue:o.enable,"onUpdate:modelValue":e[5]||(e[5]=l=>o.enable=l),placeholder:"请选择状态",clearable:"",style:{width:"180px"}},{default:a(()=>[(p(),y(V,null,k(S,l=>t(I,{key:l,label:l.value,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:a(()=>[t(s,{type:"primary",onClick:h},{default:a(()=>[...e[11]||(e[11]=[r("查询",-1)])]),_:1}),t(s,{onClick:W},{default:a(()=>[...e[12]||(e[12]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(ee,{ref_key:"tableRef",ref:f,columns:L,"fetch-data":ue(le),onSelectionChange:j},{buttons:a(()=>[t(s,{type:"success",onClick:Z},{default:a(()=>[...e[13]||(e[13]=[r("添加员工",-1)])]),_:1}),t(s,{type:"danger",onClick:M,disabled:w.value.length===0},{default:a(()=>[...e[14]||(e[14]=[r("批量删除",-1)])]),_:1},8,["disabled"])]),photo:a(({row:l})=>[se("img",{src:me+l.photo,style:{width:"50px",height:"50px"}},null,8,ie)]),operate:a(({row:l})=>[t(s,{link:"",type:"primary",onClick:g=>J(l)},{default:a(()=>[...e[15]||(e[15]=[r("重置密码",-1)])]),_:1},8,["onClick"]),t(s,{link:"",type:"primary",onClick:g=>G(l.id)},{default:a(()=>[...e[16]||(e[16]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(s,{link:"",type:"primary",onClick:z},{default:a(()=>[...e[17]||(e[17]=[r("禁用",-1)])]),_:1}),t(s,{link:"",type:"primary",onClick:q},{default:a(()=>[...e[18]||(e[18]=[r("取消禁用",-1)])]),_:1}),t(s,{link:"",type:"danger",onClick:g=>D(l.id)},{default:a(()=>[...e[19]||(e[19]=[r("删除",-1)])]),_:1},8,["onClick"])]),enable:a(({row:l})=>[r(F(l.enable===1?"否":"是"),1)]),name:a(({row:l})=>[(p(!0),y(V,null,k(l.roles,g=>(p(),y("div",{key:g.id},F(g.name),1))),128))]),_:1},8,["fetch-data"]),t(Y,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l),title:"重置密码"},{footer:a(()=>[t(s,{onClick:e[8]||(e[8]=l=>Q(x.value))},{default:a(()=>[...e[20]||(e[20]=[r("取消",-1)])]),_:1}),t(s,{type:"primary",onClick:e[9]||(e[9]=l=>K(x.value))},{default:a(()=>[...e[21]||(e[21]=[r(" 确定 ",-1)])]),_:1})]),default:a(()=>[t(A,{model:i,ref_key:"ruleFormRef",ref:x,"label-width":"auto"},{default:a(()=>[t(u,{label:"用户"},{default:a(()=>[r(F(C.value?.name),1)]),_:1}),t(u,{label:"输入新密码",prop:"newPwd",rules:[{required:!0,validator:O,trigger:"blur"}]},{default:a(()=>[t(d,{modelValue:i.newPwd,"onUpdate:modelValue":e[6]||(e[6]=l=>i.newPwd=l),type:"password"},null,8,["modelValue"])]),_:1},8,["rules"]),t(u,{label:"再次输入新密码",prop:"confirmPwd",rules:[{required:!0,validator:H,trigger:"blur"}]},{default:a(()=>[t(d,{modelValue:i.confirmPwd,"onUpdate:modelValue":e[7]||(e[7]=l=>i.confirmPwd=l),type:"password"},null,8,["modelValue"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});export{Ve as default};
