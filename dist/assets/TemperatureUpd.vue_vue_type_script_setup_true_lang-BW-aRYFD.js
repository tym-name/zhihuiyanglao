import $ from"./TemperatureSelect-Cfwk2-k6.js";import{d as j}from"./temperature-D_kE8odB.js";import{d as q,m as x,r as f,i as A,k as b,l as L,b as n,c as v,a as y,e as o,w as r,f as N,p as R,t as I,F as H,v as z,g,E as _}from"./index-DSXWNbz6.js";const G={style:{display:"flex","align-items":"center",gap:"10px"}},J={key:0,style:{color:"#666","min-width":"150px"}},K={class:"dialog-footer"},X=q({__name:"TemperatureUpd",props:x({modelValue:{type:Boolean,required:!0},editData:{type:Object,default:()=>({})}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:x(["update:modelValue","handleSuccess"],["update:modelValue"]),setup(V,{emit:k}){const p=f(),i=f(!1),c=f(1),m=A(V,"modelValue"),d=f(!1),C=V,S=k,l=b({id:0,elderlyId:0,elderlyName:"",val:"",staffId:c.value});L(()=>C.editData,t=>{t&&Object.keys(t).length&&(l.id=t.id||0,l.elderlyId=t.elderlyId||0,l.elderlyName=t.elderlyName||"",l.val=t.val?String(t.val):"",l.staffId=t.staffId||c.value)},{immediate:!0,deep:!0});const h=t=>{d.value=!1,t&&(l.elderlyId=t.elderlyId||0,l.elderlyName=t.elderlyName||"",l.staffId=c.value)},B=b({val:[{required:!0,message:"请输入体温",trigger:"blur"},{pattern:/^\d+(\.\d{1,2})?$/,message:"请输入有效的体温数值（如：37.5，最多两位小数）",trigger:"blur"},{validator:(t,e,s)=>{const u=Number(e);u<35||u>42?s(new Error("体温值需在35-42℃之间")):s()},trigger:"blur"}]}),F=()=>{l.val&&(l.val=l.val.replace(/[^\d.]/g,"").replace(/(\.\d*)\./g,"$1"))},T=()=>{d.value=!0},U=async()=>{if(!p.value)return;let t=!1;try{t=await p.value.validate()}catch{t=!1}if(t){i.value=!0;try{if(!l.id){_.error("缺少记录ID，无法修改！"),i.value=!1;return}const e=await j(l);console.log("修改体温成功",e),_.success("体温记录修改成功！"),S("handleSuccess"),m.value=!1,d.value=!1}catch(e){console.error("修改体温失败：",e),_.error("体温记录修改失败，请稍后重试！")}finally{i.value=!1}}},w=[{type:"primary",text:"选择老人"}];return(t,e)=>{const s=n("el-button"),u=n("el-form-item"),E=n("el-input"),M=n("el-form"),O=n("el-dialog");return y(),v("div",null,[o(O,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=a=>m.value=a),title:"编辑体温记录",width:"500","close-on-click-modal":!1},{footer:r(()=>[N("div",K,[o(s,{onClick:e[1]||(e[1]=a=>m.value=!1)},{default:r(()=>[...e[4]||(e[4]=[g("取消",-1)])]),_:1}),o(s,{type:"primary",onClick:U,loading:i.value},{default:r(()=>[...e[5]||(e[5]=[g(" 提交 ",-1)])]),_:1},8,["loading"])])]),default:r(()=>[o(M,{ref_key:"ruleFormRef",ref:p,style:{"max-width":"600px"},model:l,rules:B,"label-width":"auto"},{default:r(()=>[o(u,{label:"老人姓名",prop:"elderlyName"},{default:r(()=>[N("div",G,[l.elderlyName?(y(),v("span",J,I(l.elderlyName),1)):R("",!0),(y(),v(H,null,z(w,a=>o(s,{onClick:T,key:a.text,type:a.type,text:"",bg:""},{default:r(()=>[g(I(a.text),1)]),_:2},1032,["type"])),64))])]),_:1}),o(u,{label:"体温",prop:"val"},{default:r(()=>[o(E,{modelValue:l.val,"onUpdate:modelValue":e[0]||(e[0]=a=>l.val=a),placeholder:"请输入体温（如：37.5）",suffix:"°C",onBlur:F},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o($,{onHandleSuccess2:h,modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a)},null,8,["modelValue"])])}}});export{X as _};
