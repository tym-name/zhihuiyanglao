import{T as ae}from"./table-BDVlGf5e.js";import{p as oe,g as se,u as de,a as re,b as ue,c as ie,d as ce,e as pe}from"./activity-DcouU_la.js";import{d as G,r,l as H,b as n,n as Y,a as b,w as t,e as l,c as T,g as y,t as P,F as K,v as Q,f as I,u as z,_ as le,m as me,x as fe,i as ye,j as ve,k as _e,y as ge,E as V,h as ee,p as he}from"./index-DSXWNbz6.js";const be=["src"],Ve=G({__name:"ViewDetails",props:{drawer:{type:Boolean},id:{},typeList:{},close:{type:Function}},setup(S){const C="http://123.57.237.81:8080/caresystem/",k=S,v=r(null);H(()=>k.id,d=>{v.value=d,B()});const u=r([]);H(()=>k.typeList,d=>{u.value=d});const _=r(null),B=async()=>{if(v.value)try{let d=await oe(v.value);console.log("单条院内活动信息",d),_.value=d.data,d.data&&o(d.data),N(d.data.content)}catch(d){console.error("获取活动详情失败:",d)}},s=r(""),o=d=>{u.value.forEach(m=>{d.type===m.id&&(s.value=m.name)})},x=r(""),N=d=>x.value=d.replace(/<[^>]*>/g,"");return(d,m)=>{const h=n("el-form-item"),i=n("el-button"),L=n("el-form"),D=n("el-drawer");return b(),Y(D,{modelValue:k.drawer,"onUpdate:modelValue":m[0]||(m[0]=c=>k.drawer=c),title:"查看详情"},{default:t(()=>[l(L,{"label-width":"auto"},{default:t(()=>[l(h,{label:"活动名称:"},{default:t(()=>[y(P(_.value?.title),1)]),_:1}),l(h,{label:"分类:"},{default:t(()=>[y(P(s.value),1)]),_:1}),l(h,{label:"参与老人:"},{default:t(()=>[(b(!0),T(K,null,Q(_.value?.elderly,c=>(b(),T("div",{class:"content title_content",key:c.id},P(c.elderlyName),1))),128))]),_:1}),l(h,{label:"活动内容:"},{default:t(()=>[y(P(x.value),1)]),_:1}),(b(!0),T(K,null,Q(_.value?.pictures,c=>(b(),Y(h,{label:"图片:",key:c},{default:t(()=>[I("img",{src:z(C)+c.picture,alt:"",class:"image"},null,8,be)]),_:2},1024))),128)),l(h,{label:"上报时间:"},{default:t(()=>[y(P(_.value?.addTime),1)]),_:1}),l(h,null,{default:t(()=>[l(i,{onClick:k.close},{default:t(()=>[...m[1]||(m[1]=[y("关闭",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])}}}),Ce=le(Ve,[["__scopeId","data-v-f12c422f"]]),ke={style:{border:"1px solid #ccc"}},te="default",we=G({__name:"Ediort",props:me({height:{default:300}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(S){const C=fe(),k={},v=ye(S,"modelValue"),_={overflowY:"hidden",height:`${S.height}px`},B={placeholder:"请输入内容...",MENU_CONF:{uploadImage:{fieldName:"file",server:"undefinedupload/add",headers(){return{Authorization:sessionStorage.getItem("token")||"","Content-Type":"multipart/form-data"}},customInsert(o,x){if(o.errCode===1e4){const N=`http://123.57.237.81:8080/caresystem/${o.data}`;x(N,"","")}}}}},s=o=>{C.value=o};return(o,x)=>{const N=n("Toolbar"),d=n("Editor");return b(),T("div",null,[I("div",ke,[l(N,{style:{"border-bottom":"1px solid #ccc"},editor:C.value,defaultConfig:k,mode:te},null,8,["editor"]),l(d,{style:_,modelValue:v.value,"onUpdate:modelValue":x[0]||(x[0]=m=>v.value=m),defaultConfig:B,mode:te,onOnCreated:s},null,8,["modelValue"])])])}}}),Ie={class:"dialog-footer"},xe=G({__name:"ChoseElderly",props:{isShow:{type:Boolean},close:{type:Function},open:{type:Function}},emits:["confirm"],setup(S,{emit:C}){const k="http://123.57.237.81:8080/caresystem/",v=S,u=C,_=r(null),B=[{type:"selection",width:"50"},{label:"姓名",prop:"name"},{label:"头像",slot:"header"},{label:"性别",slot:"sex"},{label:"身份证号",prop:"idCard",width:"170"}],s=r({name:"",idCard:""}),o=()=>{_.value.refresh()},x=()=>{s.value={name:"",idCard:""},_.value.refresh()},N=r([]),d=h=>{N.value=h},m=()=>{u("confirm",N.value),v.close()};return(h,i)=>{const L=n("el-input"),D=n("el-form-item"),c=n("el-button"),M=n("el-form"),$=n("el-image"),j=n("el-dialog");return b(),T("div",null,[l(j,{modelValue:v.isShow,"onUpdate:modelValue":i[2]||(i[2]=w=>v.isShow=w),title:"选择老人",width:"750"},{footer:t(()=>[I("div",Ie,[l(c,{onClick:v.close},{default:t(()=>[...i[5]||(i[5]=[y("取消",-1)])]),_:1},8,["onClick"]),l(c,{type:"primary",onClick:m},{default:t(()=>[...i[6]||(i[6]=[y(" 确定 ",-1)])]),_:1})])]),default:t(()=>[l(ae,{ref_key:"tableRef",ref:_,columns:B,"fetch-data":z(se),"init-params":s.value,onSelectionChange:d},{search:t(()=>[l(M,{inline:!0,class:"demo-form-inline",style:{width:"670px",border:"none",padding:"0"}},{default:t(()=>[l(D,{label:"老人姓名"},{default:t(()=>[l(L,{modelValue:s.value.name,"onUpdate:modelValue":i[0]||(i[0]=w=>s.value.name=w),placeholder:"请输入老人姓名",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(D,{label:"身份证号"},{default:t(()=>[l(L,{modelValue:s.value.name,"onUpdate:modelValue":i[1]||(i[1]=w=>s.value.name=w),placeholder:"请输入身份证号",clearable:"",style:{width:"150px"}},null,8,["modelValue"])]),_:1}),l(D,null,{default:t(()=>[l(c,{type:"primary",onClick:o},{default:t(()=>[...i[3]||(i[3]=[y("查询",-1)])]),_:1}),l(c,{onClick:x},{default:t(()=>[...i[4]||(i[4]=[y("重置",-1)])]),_:1})]),_:1})]),_:1})]),header:t(({row:w})=>[l($,{style:{width:"50px",height:"50px"},src:z(k)+w.photo},null,8,["src"])]),sex:t(({row:w})=>[I("span",null,P(w.gender==1?"男":"女"),1)]),_:1},8,["fetch-data","init-params"])]),_:1},8,["modelValue"])])}}}),Ne={key:0,class:"elderly-list"},Ue=["src"],Te={class:"dialog-footer"},De=G({__name:"PlayAddOrUpdate",props:{open:{type:Boolean},close:{type:Function},options:{},id:{},palyDate:{},Refresh:{type:Function}},setup(S){const C="http://123.57.237.81:8080/caresystem-server/api",k="http://123.57.237.81:8080/caresystem/",v=C+"/upload/add",u=S;H(()=>u.id,e=>{_.value=e});const _=r(),B=ve(()=>u.id?"修改院内活动":"增加院内活动"),s=r(),o=r({title:"",type:null,content:"",elderly:[],pictures:[]}),x=_e({title:[{required:!0,message:"请输入活动标题",trigger:"blur"}],type:[{required:!0,message:"请选择活动分类",trigger:"change"}],content:[{required:!0,message:"请输入活动内容",trigger:"blur"}],elderly:[{required:!0,message:"请选择老人",trigger:"change"}],pictures:[{required:!0,message:"请上传活动图片",trigger:"change"}]}),N={Authorization:"Bearer token123"},d=r([]),m=r(!1),h=r(""),i=r(!1),L=()=>{i.value=!1},D=()=>{i.value=!0},c=r([]),M=e=>{c.value=e,o.value.elderly=e.map(a=>({elderlyId:a.id}))};H(()=>o.value.pictures,e=>{e?d.value=e.map((a,R)=>({name:`图片${R+1}`,url:k+a.picture,uid:Date.now()+R,status:"success"})):d.value=[]},{immediate:!0,deep:!0}),H(()=>u.palyDate,e=>{e?(o.value.title=e.title,o.value.type=e.type,o.value.content=e.content,o.value.elderly=e.elderly.map(a=>({elderlyId:a.elderlyId})),o.value.pictures=e.pictures,c.value=e.elderly.map(a=>({id:a.elderlyId,companyId:0,name:a.elderlyName||"",mobile:"",photo:a.elderlyPhoto||"",gender:0,birthday:"",nativePlace:"",nation:"",idCard:"",politics:"",socialCard:"",marriage:"",eduLevel:"",education:"",resident:"",address:"",begId:0,houseId:0,state:0,addTime:"",addAccountId:0,stateName:"",begName:a.begName,addAccountName:"",houseName:a.houseName,buildingName:a.buildingName,health:null,selfCares:null,checkups:null,family:null}))):F()},{immediate:!0});const $=e=>{h.value=e.url,m.value=!0},j=e=>{const a=d.value.findIndex(R=>R.uid===e.uid);a!==-1&&(d.value.splice(a,1),o.value.pictures.splice(a,1),V.success("图片删除成功"))},w=e=>{e?.code===1e4&&e.data?.url?(o.value.pictures.push({picture:e.data.url}),V.success("图片上传成功")):V.error(e?.msg||"上传失败")},q=e=>{const a=e.type.startsWith("image/"),R=e.size/1024/1024<=5;return a?R?!0:(V.error("单张图片大小不能超过5MB"),!1):(V.error("只允许上传图片文件"),!1)},W=async()=>{if(s.value){try{if(!await s.value.validate())return}catch{V.error("表单校验失败，请检查填写内容");return}if(_.value)try{const e={...o.value,id:u.id};let a=await de(e);console.log("修改",a),a.code===1e4?(V.success("修改成功"),u.Refresh(),u.close(),F()):V.error("修改失败："+(a.msg||"服务器异常"))}catch(e){V.error("修改失败：网络异常"),console.error("修改活动报错：",e)}else try{let e=await re(o.value);console.log("添加",e),e.code===1e4?(V.success("添加成功"),u.Refresh(),u.close(),F(),_.value=0):V.error("添加失败："+(e.msg||"服务器异常"))}catch(e){V.error("添加失败：网络异常"),console.error("新增活动报错：",e)}}},F=()=>{s.value&&(s.value.clearValidate(),s.value.resetFields()),o.value={title:"",type:null,content:"",elderly:[],pictures:[]},c.value=[],d.value=[]},f=e=>{ee.confirm("您确定要关闭此对话框吗").then(()=>{F(),e()}).catch(()=>{})};return(e,a)=>{const R=n("el-input"),U=n("el-form-item"),J=n("el-option"),X=n("el-select"),E=n("el-tooltip"),O=n("el-button"),Z=n("el-icon"),p=n("el-upload"),A=n("el-dialog"),ne=n("el-form");return b(),T("div",null,[l(A,{modelValue:u.open,"onUpdate:modelValue":a[4]||(a[4]=g=>u.open=g),title:B.value,"before-close":f,width:"1000px"},{footer:t(()=>[I("div",Te,[l(O,{onClick:u.close},{default:t(()=>[...a[7]||(a[7]=[y("取消",-1)])]),_:1},8,["onClick"]),l(O,{type:"primary",onClick:W},{default:t(()=>[...a[8]||(a[8]=[y("提交",-1)])]),_:1})])]),default:t(()=>[l(ne,{ref_key:"ruleFormRef",ref:s,model:o.value,rules:x,"label-width":"auto"},{default:t(()=>[l(U,{label:"标题",prop:"title",style:{width:"900px"}},{default:t(()=>[l(R,{modelValue:o.value.title,"onUpdate:modelValue":a[0]||(a[0]=g=>o.value.title=g)},null,8,["modelValue"])]),_:1}),l(U,{label:"分类",prop:"type"},{default:t(()=>[l(X,{modelValue:o.value.type,"onUpdate:modelValue":a[1]||(a[1]=g=>o.value.type=g),placeholder:"请选择分类",style:{width:"240px"}},{default:t(()=>[(b(!0),T(K,null,Q(u.options,g=>(b(),Y(J,{key:g.id,label:g.name,value:g.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(U,{label:"老人",prop:"elderly"},{default:t(()=>[I("div",{onClick:D},[c.value.length>0?(b(),T("div",Ne,[l(E,{content:c.value.map(g=>g.name).join("、"),placement:"top"},{default:t(()=>[I("span",null,P(c.value.map(g=>g.name).join("、")),1)]),_:1},8,["content"])])):(b(),Y(O,{key:1,type:"primary"},{default:t(()=>[...a[5]||(a[5]=[y("选择老人",-1)])]),_:1}))])]),_:1}),l(U,{label:"活动内容",prop:"content",style:{width:"900px"}},{default:t(()=>[l(we,{height:400,modelValue:o.value.content,"onUpdate:modelValue":a[2]||(a[2]=g=>o.value.content=g)},null,8,["modelValue"])]),_:1}),l(U,{label:"上传图片",prop:"pictures"},{default:t(()=>[l(p,{class:"upload-demo",action:v,headers:N,"file-list":d.value,"list-type":"picture-card","on-preview":$,"on-remove":j,"on-success":w,"before-upload":q},{tip:t(()=>[...a[6]||(a[6]=[I("div",{class:"el-upload__tip"},"支持上传jpg/png/gif格式，单张不超过5MB",-1)])]),default:t(()=>[l(Z,null,{default:t(()=>[l(z(ge))]),_:1})]),_:1},8,["file-list"]),l(A,{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=g=>m.value=g),title:"图片预览",width:"80%"},{default:t(()=>[I("img",{"w-full":"",src:h.value,alt:"Preview Image"},null,8,Ue)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),l(xe,{open:D,close:L,isShow:i.value,onConfirm:M},null,8,["isShow"])]),_:1},8,["modelValue","title"])])}}}),Re=le(De,[["__scopeId","data-v-d1f83572"]]),Se={key:0},Be=G({__name:"Activity",setup(S){const C=r(null),k=[{type:"selection",width:"50"},{label:"序号",prop:"id"},{label:"标题",prop:"title"},{label:"老人姓名",slot:"elderlyNames"},{label:"分类",prop:"typeName"},{label:"上报人",prop:"addAccountName"},{label:"上报时间",prop:"addTime",formatTime:"YYYY-MM-DD HH:mm"},{label:"操作",width:240,slot:"operate",fixed:"right"}],v=()=>{C.value?.refresh()},u=r(!1),_=()=>{u.value=!u.value},B=()=>{u.value=!1,q.value={id:0,companyId:0,title:"",addTime:"",type:0,typeName:"",content:"",addAccountId:0,addAccountName:"",elderly:[],pictures:[]}},s=r({name:"",beginDate:"",endDate:"",type:null,key:""}),o=r([]);(async()=>{let f=await ie();console.log(f),o.value=f.data.list})();const N=()=>{C.value.refresh()},d=()=>{s.value={name:"",beginDate:"",endDate:"",type:null,key:""},C.value.refresh()},m=r(!1),h=r(0),i=f=>{m.value=!m.value,h.value=f},L=()=>{m.value=!1},D=f=>{ee.confirm("是否删除该条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await ce(f),V({type:"success",message:"删除成功"}),v()})},c=r(!0),M=r([]),$=r([]),j=f=>{M.value=f,$.value=f.map(e=>e.id),c.value=f.length===0},w=async()=>{ee.confirm("是否删除多条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let f=await pe($.value);console.log(f),f.code===1e4&&(V({type:"success",message:"删除成功"}),v())}).catch(()=>{V({type:"info",message:"取消删除"})})},q=r({id:0,companyId:0,title:"",addTime:"",type:0,typeName:"",content:"",addAccountId:0,addAccountName:"",elderly:[],pictures:[]}),W=r(0),F=async f=>{u.value=!u.value;let e=await oe(f);console.log(e),q.value=e.data,W.value=f};return(f,e)=>{const a=n("el-option"),R=n("el-select"),U=n("el-form-item"),J=n("el-input"),X=n("el-date-picker"),E=n("el-button"),O=n("el-form"),Z=n("el-tooltip");return b(),T("div",null,[l(ae,{ref_key:"tableRef",ref:C,columns:k,"fetch-data":z(ue),"init-params":s.value,onSelectionChange:j},{search:t(()=>[l(O,{inline:!0,class:"demo-form-inline"},{default:t(()=>[l(U,{label:"分类"},{default:t(()=>[l(R,{modelValue:s.value.type,"onUpdate:modelValue":e[0]||(e[0]=p=>s.value.type=p),placeholder:"请选择类型",style:{width:"240px"}},{default:t(()=>[(b(!0),T(K,null,Q(o.value,p=>(b(),Y(a,{key:p.id,label:p.name,value:p.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(U,{label:"老人姓名"},{default:t(()=>[l(J,{modelValue:s.value.name,"onUpdate:modelValue":e[1]||(e[1]=p=>s.value.name=p),placeholder:"请输入老人姓名",clearable:""},null,8,["modelValue"])]),_:1}),l(U,{label:"活动标题"},{default:t(()=>[l(J,{modelValue:s.value.key,"onUpdate:modelValue":e[2]||(e[2]=p=>s.value.key=p),placeholder:"请输入活动标题",clearable:""},null,8,["modelValue"])]),_:1}),l(U,{label:"上报时间"},{default:t(()=>[l(X,{modelValue:s.value.beginDate,"onUpdate:modelValue":e[3]||(e[3]=p=>s.value.beginDate=p),type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),l(U,null,{default:t(()=>[l(E,{type:"primary",onClick:N},{default:t(()=>[...e[4]||(e[4]=[y("查询",-1)])]),_:1}),l(E,{onClick:d},{default:t(()=>[...e[5]||(e[5]=[y("重置",-1)])]),_:1})]),_:1})]),_:1})]),buttons:t(()=>[l(E,{type:"success",onClick:_},{default:t(()=>[...e[6]||(e[6]=[y("添加",-1)])]),_:1}),l(E,{type:"danger",onClick:w,disabled:c.value},{default:t(()=>[...e[7]||(e[7]=[y("批量删除",-1)])]),_:1},8,["disabled"])]),operate:t(({row:p})=>[l(E,{link:"",type:"primary",onClick:A=>i(p.id)},{default:t(()=>[...e[8]||(e[8]=[I("i",{class:"iconfont icon-xiangqing"},null,-1),y(" 详情 ",-1)])]),_:1},8,["onClick"]),l(E,{link:"",type:"primary",onClick:A=>F(p.id)},{default:t(()=>[...e[9]||(e[9]=[I("i",{class:"iconfont icon-bianji"},null,-1),y(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(E,{link:"",type:"danger",onClick:A=>D(p.id)},{default:t(()=>[...e[10]||(e[10]=[I("i",{class:"iconfont icon-shanchu"},null,-1),y(" 删除 ",-1)])]),_:1},8,["onClick"])]),elderlyNames:t(({row:p})=>[p.elderly&&p.elderly.length>0?(b(),T("div",Se,[l(Z,{content:p.elderly.map(A=>A.elderlyName).join("、"),placement:"top"},{default:t(()=>[I("span",null,P(p.elderly.map(A=>A.elderlyName).join("、")),1)]),_:2},1032,["content"])])):he("",!0)]),_:1},8,["fetch-data","init-params"]),l(Ce,{drawer:m.value,id:h.value,typeList:o.value,close:L},null,8,["drawer","id","typeList"]),l(Re,{open:u.value,close:B,options:o.value,palyDate:q.value,id:W.value,Refresh:v},null,8,["open","options","palyDate","id"])])}}}),Pe=le(Be,[["__scopeId","data-v-4671ba70"]]);export{Pe as default};
