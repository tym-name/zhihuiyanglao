import{d as B,a0 as I,r as n,k as b,o as L,z as D,a8 as E,M,E as w,N as T,Y as U,c as _,p as k,f as o,t as W,e as t,w as a,b as r,a as f,g as R,_ as S}from"./index-DSXWNbz6.js";const A={class:"login-bind-wrapper","element-loading-text":"处理中..."},F={key:0,class:"login-bind-content"},H={key:0,class:"user-info-card"},P=["src"],Y={class:"user-desc"},j={class:"welcome-text"},G={class:"form-container"},J=B({__name:"WechatLogin",setup(K){const g=M(),u=I(),y=D(),l=n({}),d=n(!1),i=n(!1),s=b({username:"",pwd:"",openId:""}),V=async()=>{await u.userLoginBindWechat({...s})&&g.push("/")},v=n("");L(()=>{v.value=y.query.code,x(v.value)});const x=async c=>{d.value=!1,i.value=!0;const e=await E({code:c}).catch(()=>{});i.value=!1,e&&("token"in e.data?(console.log("已经绑定"),u.token=e.data.token,u.refreshToken=e.data.refreshToken,g.push({path:"/",query:{}}),w.success("微信登录成功")):(d.value=!0,console.log("未绑定"),l.value=e.data,s.openId=e.data.openid,w.success("微信登录成功")))},C=b({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],pwd:[{required:!0,message:"请输入密码",trigger:"blur"}]});return(c,e)=>{const h=r("el-input"),m=r("el-form-item"),z=r("el-button"),N=r("el-form"),q=U("loading");return T((f(),_("div",A,[d.value?(f(),_("div",F,[l.value.headimgurl?(f(),_("div",H,[o("img",{class:"avatar",src:l.value.headimgurl,alt:"微信头像",lazy:""},null,8,P),o("div",Y,[o("h3",j,"Hi，"+W(l.value?.nickname)+"，欢迎来到智慧养老 PC 端",1),e[2]||(e[2]=o("p",{class:"tips-text"},"完成绑定后可以使用微信账号一键登录哦！",-1))])])):k("",!0),o("div",G,[t(N,{model:s,"label-width":"120px",class:"bind-form",rules:C},{default:a(()=>[t(m,{label:"用户名",prop:"username"},{default:a(()=>[t(h,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=p=>s.username=p),placeholder:"请输入绑定的用户名",size:"default"},null,8,["modelValue"])]),_:1}),t(m,{label:"密码",prop:"pwd"},{default:a(()=>[t(h,{type:"password",modelValue:s.pwd,"onUpdate:modelValue":e[1]||(e[1]=p=>s.pwd=p),placeholder:"请输入用户密码",size:"default"},null,8,["modelValue"])]),_:1}),t(m,{class:"form-submit-item"},{default:a(()=>[t(z,{type:"primary",onClick:V,class:"submit-btn",size:"default"},{default:a(()=>[...e[3]||(e[3]=[R(" 微信登录绑定 ",-1)])]),_:1})]),_:1})]),_:1},8,["model","rules"])])])):k("",!0)])),[[q,i.value]])}}}),Q=S(J,[["__scopeId","data-v-0d8a35b1"]]);export{Q as default};
