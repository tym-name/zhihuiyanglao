import j from"./TemperatureSelect-CZ-TYvcv.js";import{Q as A,d as H,c as J}from"./Question-D6H1D7k_.js";import{o as L}from"./oldManRelation-BmOKY2bv.js";import{d as z,m as U,r as b,i as G,j as K,k as q,l as P,c as y,F as W,e as o,w as r,b as d,f as B,t as C,g as p,E as u,h as X,a as V,_ as Z}from"./index-DSXWNbz6.js";import"./elderly-p1gfo6w8.js";import"./table-BDVlGf5e.js";const ee={style:{display:"flex","align-items":"center",gap:"10px"}},le={key:0,style:{color:"#666","min-width":"150px"}},te={key:1,style:{color:"#999","min-width":"150px"}},oe={class:"dialog-footer"},ae=z({__name:"QuestionUpd",props:U({editData:{type:Object,required:!1,default:()=>({})}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:U(["addRefresh","update:dialogVisible","refreshTable"],["update:modelValue"]),setup(_,{emit:N}){const x=_,w=N,n=b(),c=b(!1),f=G(_,"modelValue"),g=b(!1),s=K(()=>!!x.editData.id),e=q({id:0,customerId:0,elderlyName:"",type:"",source:"",name:"",mobile:"",relation:"",visitTime:"",content:""});P(()=>x.editData,t=>{!t||!t.id||(n.value&&n.value.clearValidate(),Object.assign(e,JSON.parse(JSON.stringify(t))))},{immediate:!0,deep:!0});const M=q({customerId:[{required:!0,message:"请选择关联的老人",trigger:"change"}],type:[{required:!0,message:"请选择咨询类型",trigger:"change"}],source:[{required:!0,message:"请选择咨询渠道",trigger:"change"}],name:[{required:!0,message:"请输入咨询人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号码",trigger:"blur"}],relation:[{required:!0,message:"请选择与老人的关系",trigger:"change"}],visitTime:[{required:!0,message:"请选择咨询时间",trigger:"change"}],content:[{required:!0,message:"请输入咨询内容",trigger:"blur"}]}),F=t=>{t&&t.id?(e.customerId=t.id,e.elderlyName=t.name,g.value=!1,u.success("老人选择成功")):u.error("未获取到有效的老人信息")},S=()=>{g.value=!0},k=t=>{typeof e[t]=="string"&&(e[t]=e[t].trim())},I=()=>{const t=e.mobile.trim();t&&!/^1[3-9]\d{9}$/.test(t)&&u.warning("手机号格式不正确，请检查")},D=t=>{console.log("选择的咨询渠道：",t)},E=async()=>{if(n.value){try{await n.value.validate(),await X.confirm(s?"确定要保存修改的咨询登记信息吗？":"确定要提交这条咨询登记信息吗？",s?"修改确认":"提交确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),c.value=!0;let t;if(s.value)t=await H(e);else{const{id:l,...m}=e;t=await J(m)}t&&t.code===1e4?(u.success(s.value?"咨询登记修改成功！":"咨询登记提交成功！"),f.value=!1,w("addRefresh")):u.error((s.value?"修改":"提交")+"失败："+(t?.msg||"服务器返回异常"))}catch(t){t==="cancel"?u.info("已取消"+(s.value?"修改":"提交")):t.name==="ValidationError"?u.error("请完善表单必填项并确保格式正确"):(console.error("咨询登记操作出错：",t),u.error((s.value?"修改":"提交")+"失败，请稍后重试"))}finally{c.value=!1}w("refreshTable")}},h=()=>{O()},O=()=>{e.id=0,e.customerId=0,e.elderlyName="",e.type="",e.source="",e.name="",e.mobile="",e.relation="",e.visitTime="",e.content="",n.value&&(n.value.clearValidate(),n.value.resetFields())};return(t,l)=>{const m=d("el-button"),i=d("el-form-item"),T=d("el-radio"),R=d("el-radio-group"),v=d("el-input"),$=d("el-date-picker"),Q=d("el-form"),Y=d("el-dialog");return V(),y(W,null,[o(Y,{modelValue:f.value,"onUpdate:modelValue":l[10]||(l[10]=a=>f.value=a),title:s.value?"编辑咨询登记":"新增咨询登记",width:"700px","close-on-click-modal":!1,onClose:h},{footer:r(()=>[B("div",oe,[o(m,{onClick:l[9]||(l[9]=a=>f.value=!1)},{default:r(()=>[...l[15]||(l[15]=[p("取消",-1)])]),_:1}),o(m,{type:"primary",onClick:E,loading:c.value},{default:r(()=>[p(C(s.value?"保存修改":"提交"),1)]),_:1},8,["loading"])])]),default:r(()=>[o(Q,{ref_key:"ruleFormRef",ref:n,style:{"max-width":"600px"},model:e,rules:M,"label-width":"100px"},{default:r(()=>[o(i,{label:"老人姓名",prop:"customerId"},{default:r(()=>[B("div",ee,[e.elderlyName?(V(),y("span",le,C(e.elderlyName),1)):(V(),y("span",te," 未选择老人 ")),o(m,{onClick:S,type:"primary",text:"",bg:""},{default:r(()=>[...l[12]||(l[12]=[p(" 选择老人 ",-1)])]),_:1})])]),_:1}),o(i,{label:"咨询类型",prop:"type"},{default:r(()=>[o(A,{modelValue:e.type,"onUpdate:modelValue":l[0]||(l[0]=a=>e.type=a)},null,8,["modelValue"])]),_:1}),o(i,{label:"咨询渠道",prop:"source"},{default:r(()=>[o(R,{modelValue:e.source,"onUpdate:modelValue":l[1]||(l[1]=a=>e.source=a),onChange:D},{default:r(()=>[o(T,{label:"来访登记"},{default:r(()=>[...l[13]||(l[13]=[p("来访登记",-1)])]),_:1}),o(T,{label:"电话"},{default:r(()=>[...l[14]||(l[14]=[p("电话",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"咨询人",prop:"name"},{default:r(()=>[o(v,{modelValue:e.name,"onUpdate:modelValue":l[2]||(l[2]=a=>e.name=a),placeholder:"请输入咨询人姓名",onBlur:l[3]||(l[3]=a=>k("name"))},null,8,["modelValue"])]),_:1}),o(i,{label:"联系电话",prop:"mobile"},{default:r(()=>[o(v,{modelValue:e.mobile,"onUpdate:modelValue":l[4]||(l[4]=a=>e.mobile=a),placeholder:"请输入11位手机号码",onBlur:I},null,8,["modelValue"])]),_:1}),o(i,{label:"与老人关系",prop:"relation"},{default:r(()=>[o(L,{modelValue:e.relation,"onUpdate:modelValue":l[5]||(l[5]=a=>e.relation=a)},null,8,["modelValue"])]),_:1}),o(i,{label:"咨询时间",prop:"visitTime"},{default:r(()=>[o($,{modelValue:e.visitTime,"onUpdate:modelValue":l[6]||(l[6]=a=>e.visitTime=a),type:"datetime","value-format":"YYYY-MM-DD HH:mm",placeholder:"请选择咨询时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),o(i,{label:"咨询内容",prop:"content"},{default:r(()=>[o(v,{modelValue:e.content,"onUpdate:modelValue":l[7]||(l[7]=a=>e.content=a),style:{width:"100%"},rows:2,type:"textarea",placeholder:"请详细输入咨询内容",onBlur:l[8]||(l[8]=a=>k("content"))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(j,{onHandleSuccess2:F,modelValue:g.value,"onUpdate:modelValue":l[11]||(l[11]=a=>g.value=a)},null,8,["modelValue"])],64)}}}),me=Z(ae,[["__scopeId","data-v-e93184f7"]]);export{me as default};
