import{d as Q,m as Y,r as V,i as H,k as _,c as k,e as r,w as a,b as u,f,p as w,n as D,t as L,g as d,N as x,aa as N,E as n,a as y,_ as O}from"./index-DSXWNbz6.js";import j from"./TemperatureSelect-CZ-TYvcv.js";import{Q as z,c as G}from"./Question-D6H1D7k_.js";import{o as J}from"./oldManRelation-BmOKY2bv.js";import"./elderly-p1gfo6w8.js";import"./table-BDVlGf5e.js";const K={style:{display:"flex","align-items":"center",gap:"10px"}},P={key:0,style:{color:"#666","min-width":"150px"}},W={class:"dialog-footer"},X=Q({__name:"QuestionAdd",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:Y(["addRefresh","refreshTable"],["update:modelValue"]),setup(T,{emit:U}){const i=V(),g=V(!1),m=H(T,"modelValue"),p=V(!1),q=U,e=_({customerId:0,customerName:"",elderlyName:"",type:"",source:"",name:"",mobile:"",relation:"",visitTime:"",content:""}),C=_({customerId:[{required:!0,message:"请选择关联的老人",trigger:"change"}],type:[{required:!0,message:"请选择咨询类型",trigger:"change"}],source:[{required:!0,message:"请输入咨询渠道",trigger:"blur"}],name:[{required:!0,message:"请输入咨询人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号码",trigger:"blur"}],relation:[{required:!0,message:"请选择与老人的关系",trigger:"change"}],visitTime:[{required:!0,message:"请选择咨询时间",trigger:"change"}],content:[{required:!0,message:"请输入咨询内容",trigger:"blur"}]}),M=t=>{t&&t.id?(e.customerId=t.id,e.customerName=t.name,e.elderlyName=t.name,p.value=!1,n.success("老人选择成功")):n.error("未获取到有效的老人信息")},B=()=>{p.value=!0},b=t=>{typeof e[t]=="string"&&(e[t]=e[t].trim())},I=()=>{const t=e.mobile.trim();t&&!/^1[3-9]\d{9}$/.test(t)&&n.warning("手机号格式不正确，请检查")},A=async()=>{if(i.value)try{await i.value.validate(),g.value=!0;const t=await G(e);t&&t.code===1e4?(n.success("咨询登记新增成功！"),m.value=!1,q("refreshTable")):n.error("新增失败："+(t?.msg||"服务器返回异常"))}catch(t){t.name==="ValidationError"?n.error("请完善表单必填项并确保格式正确"):(console.error("咨询登记新增出错：",t),n.error("新增失败，请稍后重试"))}finally{g.value=!1}},F=()=>{R()},R=()=>{e.customerId=0,e.customerName="",e.elderlyName="",e.type="",e.source="",e.name="",e.mobile="",e.relation="",e.visitTime="",e.content="",i.value&&i.value.clearValidate()};return(t,l)=>{const c=u("el-button"),s=u("el-form-item"),v=u("el-input"),S=u("el-date-picker"),$=u("el-form"),E=u("el-dialog");return y(),k("div",null,[r(E,{modelValue:m.value,"onUpdate:modelValue":l[11]||(l[11]=o=>m.value=o),title:"新增咨询登记",width:"700px","close-on-click-modal":!1,onClose:F},{footer:a(()=>[f("div",W,[r(c,{onClick:l[10]||(l[10]=o=>m.value=!1)},{default:a(()=>[...l[16]||(l[16]=[d("取消",-1)])]),_:1}),r(c,{type:"primary",onClick:A,loading:g.value},{default:a(()=>[...l[17]||(l[17]=[d(" 提交 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[r($,{ref_key:"ruleFormRef",ref:i,style:{"max-width":"600px"},model:e,rules:C,"label-width":"100px"},{default:a(()=>[r(s,{label:"老人姓名",prop:"customerId"},{default:a(()=>[f("div",K,[e.elderlyName?(y(),k("span",P,L(e.elderlyName),1)):w("",!0),e.elderlyName?w("",!0):(y(),D(c,{key:1,onClick:B,type:"primary",text:"",bg:""},{default:a(()=>[...l[13]||(l[13]=[d(" 选择老人 ",-1)])]),_:1}))])]),_:1}),r(s,{label:"咨询类型",prop:"type"},{default:a(()=>[r(z,{modelValue:e.type,"onUpdate:modelValue":l[0]||(l[0]=o=>e.type=o)},null,8,["modelValue"])]),_:1}),r(s,{label:"咨询渠道",prop:"source"},{default:a(()=>[x(f("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=o=>e.source=o),value:"来访登记",name:"source"},null,512),[[N,e.source]]),l[14]||(l[14]=d("来访登记 ",-1)),x(f("input",{type:"radio","onUpdate:modelValue":l[2]||(l[2]=o=>e.source=o),value:"电话",name:"source"},null,512),[[N,e.source]]),l[15]||(l[15]=d("电话 ",-1))]),_:1}),r(s,{label:"咨询人",prop:"name"},{default:a(()=>[r(v,{modelValue:e.name,"onUpdate:modelValue":l[3]||(l[3]=o=>e.name=o),placeholder:"请输入咨询人姓名",onBlur:l[4]||(l[4]=o=>b("name"))},null,8,["modelValue"])]),_:1}),r(s,{label:"联系电话",prop:"mobile"},{default:a(()=>[r(v,{modelValue:e.mobile,"onUpdate:modelValue":l[5]||(l[5]=o=>e.mobile=o),placeholder:"请输入11位手机号码",onBlur:I},null,8,["modelValue"])]),_:1}),r(s,{label:"与老人关系",prop:"relation"},{default:a(()=>[r(J,{modelValue:e.relation,"onUpdate:modelValue":l[6]||(l[6]=o=>e.relation=o)},null,8,["modelValue"])]),_:1}),r(s,{label:"咨询时间",prop:"visitTime"},{default:a(()=>[r(S,{modelValue:e.visitTime,"onUpdate:modelValue":l[7]||(l[7]=o=>e.visitTime=o),type:"datetime","value-format":"YYYY-MM-DD HH:mm",placeholder:"请选择咨询时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),r(s,{label:"咨询内容",prop:"content"},{default:a(()=>[r(v,{modelValue:e.content,"onUpdate:modelValue":l[8]||(l[8]=o=>e.content=o),style:{width:"100%"},rows:2,type:"textarea",placeholder:"请详细输入咨询内容",onBlur:l[9]||(l[9]=o=>b("content"))},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),r(j,{onHandleSuccess2:M,modelValue:p.value,"onUpdate:modelValue":l[12]||(l[12]=o=>p.value=o)},null,8,["modelValue"])])}}}),re=O(X,[["__scopeId","data-v-112cd3dc"]]);export{re as default};
