import{T as F}from"./table-B1my3jl3.js";import{g as R,b as j,e as q,a as O}from"./elderly-D3Co0WB3.js";import{d as Q,r as c,n as G,w as a,u as H,h as v,e as n,g as m,f as i,a as p,c as J,x as K,F as P,v as W,b as w,Q as _,E as B,_ as X}from"./index-D6YPj1KB.js";const Y=Q({__name:"Elderly",setup(Z){const b=c(null),k=c(!0),r=c({name:"",idCard:"",begId:0,state:null}),x=c([]),E=c({page:1,pageSize:10});(async()=>{try{let l=await j(E.value);console.log("床位列表",l),x.value=l.data.list||[],V.value=D(x.value)}catch(l){console.error("获取床位列表失败：",l),v.error("获取床位数据失败，请稍后重试")}})();const V=c([]),D=l=>{const e=new Map;l.forEach(o=>{e.set(o.id,o)});const s=[];return l.filter(o=>o.pid===0).forEach(o=>{const f={value:o.id,label:o.name,children:[]},h=l.filter(u=>u.pid===o.id);h.forEach(u=>{const g={value:u.id,label:u.name,children:[]},t=l.filter(d=>d.pid===u.id);t.forEach(d=>{g.children.push({value:d.id,label:d.name})}),(g.children.length>0||t.length>0)&&f.children.push(g)}),(f.children.length>0||h.length>0)&&s.push(f)}),s},I=()=>{b.value?.refresh()},$=[{type:"selection",width:"50"},{label:"序号",prop:"id",width:"100px"},{label:"头像",image:"photo"},{label:"老人姓名",prop:"name"},{label:"性别",prop:"state",slot:"gender"},{label:"身份证号",prop:"idCard",width:180},{label:"床位",prop:"begName"},{label:"状态",prop:"stateName"},{label:"操作",slot:"operate",width:520,fixed:"right"}],N=[{value:"1",label:"未签约"},{value:"2",label:"预定中"},{value:"3",label:"已住院"}],T=()=>{_.push("/elderly-edit")},L=l=>{console.log("点击修改老人",l),_.push(`/elderly-edit?id=${l.id}`)},M=l=>{_.push(`/elderly-records?id=${l.id}`)},S=l=>{_.push(`/elderly-work?id=${l.id}`)},U=l=>{B.confirm("是否删除该条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await q(l),v({type:"success",message:"删除成功"}),b.value?.refresh()}).catch(()=>{v({type:"info",message:"已取消删除"})})},y=c([]),A=()=>{y.value.length!==0&&B.confirm(`是否删除选中的 ${y.value.length} 条记录？`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const l=y.value.map(e=>e.id);await O(l),v({type:"success",message:"批量删除成功"}),b.value?.getData(),k.value=!0}).catch(()=>{v({type:"info",message:"已取消删除"})})},z=l=>{console.log("选中的数据：",l),y.value=l,k.value=l.length===0};return(l,e)=>{const s=p("el-button"),C=p("el-input"),o=p("el-form-item"),f=p("el-cascader"),h=p("el-option"),u=p("el-select"),g=p("el-form");return w(),G(F,{ref_key:"tableRef",ref:b,onSelectionChange:z,"init-params":r.value,columns:$,"fetch-data":H(R)},{buttons:a(()=>[n(s,{type:"primary",onClick:T},{default:a(()=>[...e[4]||(e[4]=[i("新增老人",-1)])]),_:1}),n(s,{type:"danger",onClick:A,disabled:k.value},{default:a(()=>[...e[5]||(e[5]=[m("i",{class:"iconfont icon-shanchu"},null,-1),i("批量删除",-1)])]),_:1},8,["disabled"])]),gender:a(({row:t})=>[i(W(t.gender===1?"男":"女"),1)]),search:a(()=>[n(g,{inline:!0,class:"demo-form-inline"},{default:a(()=>[n(o,{label:"老人姓名:"},{default:a(()=>[n(C,{placeholder:"请输入老人姓名",modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value.name=t),clearable:""},null,8,["modelValue"])]),_:1}),n(o,{label:"身份证号:"},{default:a(()=>[n(C,{placeholder:"请输入身份证号",modelValue:r.value.idCard,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.idCard=t),clearable:""},null,8,["modelValue"])]),_:1}),n(o,{label:"床位:"},{default:a(()=>[n(f,{modelValue:r.value.begId,"onUpdate:modelValue":e[2]||(e[2]=t=>r.value.begId=t),options:V.value,placeholder:"请选择床位",clearable:"",style:{width:"200px"}},null,8,["modelValue","options"])]),_:1}),n(o,{label:"入住状况:"},{default:a(()=>[n(u,{placeholder:"请选择入住状况",modelValue:r.value.state,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.state=t),style:{width:"200px"}},{default:a(()=>[(w(),J(P,null,K(N,t=>n(h,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(o,null,{default:a(()=>[n(s,{type:"primary",onClick:I},{default:a(()=>[...e[6]||(e[6]=[i("查询",-1)])]),_:1}),n(s,null,{default:a(()=>[...e[7]||(e[7]=[i("重置",-1)])]),_:1})]),_:1})]),_:1})]),operate:a(({row:t})=>[n(s,{link:"",type:"primary",onClick:d=>L(t)},{default:a(()=>[...e[8]||(e[8]=[m("i",{class:"iconfont icon-bianji"},null,-1),i("编辑",-1)])]),_:1},8,["onClick"]),n(s,{link:"",type:"primary",onClick:d=>M(t)},{default:a(()=>[...e[9]||(e[9]=[m("i",{class:"iconfont icon-file"},null,-1),i("档案管理",-1)])]),_:1},8,["onClick"]),n(s,{link:"",type:"primary",onClick:d=>S(t)},{default:a(()=>[...e[10]||(e[10]=[m("i",{class:"iconfont icon-zixun"},null,-1),i("排班管理",-1)])]),_:1},8,["onClick"]),n(s,{link:"",type:"primary"},{default:a(()=>[...e[11]||(e[11]=[m("i",{class:"iconfont icon-xiangqing"},null,-1),i("计划任务",-1)])]),_:1}),n(s,{link:"",type:"danger",onClick:d=>U(t.id)},{default:a(()=>[...e[12]||(e[12]=[m("i",{class:"iconfont icon-shanchu"},null,-1),i("删除",-1)])]),_:1},8,["onClick"])]),_:1},8,["init-params","fetch-data"])}}}),ne=X(Y,[["__scopeId","data-v-68205889"]]);export{ne as default};
