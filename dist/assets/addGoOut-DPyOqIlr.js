import{d as j,r as g,k as S,l as D,o as A,E as n,c as I,e as r,w as d,b as u,z as $,f as H,t as J,F as q,g as _,M as K,a as v,_ as L}from"./index-DSXWNbz6.js";import{_ as P}from"./Relation.vue_vue_type_script_setup_true_lang-BFgC7YOg.js";const Q={style:{"font-size":"18px","font-weight":"600","margin-bottom":"20px","padding-bottom":"10px","border-bottom":"1px solid #e4e7ed"}},W={name:"AddGoOut"},X=j({...W,props:{elderlyInfo:{},editInfo:{}},emits:["submitSuccess","cancel"],setup(h,{expose:E,emit:F}){const c=$(),N=K(),s=h,T=F,y=g(!1),i=g(!!s.editInfo),k=g("default"),p=g(),f=g(null),b=()=>{const t=Number(c.query.id),l=s.elderlyInfo?.id||t||Number(c.query.elderlyId)||Number(localStorage.getItem("elderlyId"))||0,a=s.elderlyInfo?.name||c.query.elderlyName||localStorage.getItem("elderlyName")||"";return console.log("获取老人信息:",{elderlyId:l,elderlyName:a}),{elderlyId:l,elderlyName:a}},V=()=>{const{elderlyId:t,elderlyName:l}=b();return s.editInfo?{...s.editInfo,elderlyId:s.editInfo.elderlyId||t,elderlyName:s.editInfo.elderlyName||l}:{name:"",id:0,companyId:Number(localStorage.getItem("companyId"))||0,elderlyId:t,elderlyName:l,startTime:"",endTime:"",mobile:"",address:"",content:"",state:0,relation:"",addTime:new Date().toISOString(),addAccountId:Number(localStorage.getItem("userId"))||0}},e=S(V()),Y=S({elderlyName:[{required:!0,message:"请先选择外出老人",trigger:"blur"}],startTime:[{required:!0,message:"请选择外出时间",trigger:"change"},{validator:(t,l,a)=>{!e.startTime||!e.endTime?a(new Error("请完整选择开始和结束时间")):new Date(e.startTime)>new Date(e.endTime)?a(new Error("开始时间不能晚于结束时间")):a()},trigger:"change"}],relation:[{required:!0,message:"请选择陪同人关系",trigger:"blur"}],name:[{required:!0,message:"请输入陪同人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入陪同人电话",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],address:[{required:!0,message:"请输入陪同人地址",trigger:"blur"}],content:[{required:!0,message:"请输入外出原因",trigger:"blur"}]}),z=t=>{t?.id&&t?.name!==void 0?(e.elderlyId=t.id,e.elderlyName=t.name,localStorage.setItem("elderlyId",t.id.toString()),localStorage.setItem("elderlyName",t.name||"")):n.error("老人信息不完整")},C=t=>{if(t){const[l,a]=t;if(new Date(l)>new Date(a)){n.error("开始时间不能晚于结束时间，请重新选择"),f.value=null,e.startTime="",e.endTime="";return}e.startTime=l,e.endTime=a}else e.startTime="",e.endTime=""},M=()=>{T("cancel"),N.push("/care/GoOut")},O=async()=>{if(p.value){try{await p.value.validate()}catch{n.error("请完善表单必填项");return}if(!e.elderlyId||!e.elderlyName){n.error("请先选择外出老人");return}if(!e.startTime||!e.endTime){n.error("请完整选择外出时间");return}y.value=!0;try{setTimeout(()=>{i.value?n.success("修改成功"):n.success("添加成功"),T("submitSuccess"),N.push("/care/GoOut")},500)}catch(t){n.error("网络异常，请稍后重试"),console.error("提交失败：",t)}finally{y.value=!1}}},R=()=>{p.value&&p.value.resetFields(),f.value=null;const{elderlyId:t,elderlyName:l}=b();Object.assign(e,{name:"",elderlyId:t,elderlyName:l,startTime:"",endTime:"",mobile:"",address:"",content:"",relation:"",id:i.value?e.id:0})},w=()=>{i.value&&(e.startTime&&e.endTime&&(f.value=[e.startTime,e.endTime]),console.log("编辑模式初始化数据:",e))};return D([()=>c.query.elderlyId,()=>c.query.elderlyName],()=>{const{elderlyId:t,elderlyName:l}=b();e.elderlyId=t,e.elderlyName=l},{immediate:!0}),D(()=>s.editInfo,t=>{t&&(i.value=!0,Object.assign(e,V()),w())},{immediate:!0}),A(()=>{w(),i.value?console.log("进入编辑模式"):e.elderlyId?console.log("进入新增模式，已选择老人:",e.elderlyName):n.warning("请先返回选择外出老人")}),E({resetForm:R,handleSingleElderly:z}),(t,l)=>{const a=u("el-input"),m=u("el-form-item"),U=u("el-date-picker"),G=u("el-form"),x=u("el-button"),B=u("el-card");return v(),I("div",null,[r(B,null,{default:d(()=>[H("div",Q,J(i.value?"编辑外出登记":"新增外出登记"),1),r(G,{ref_key:"ruleFormRef",ref:p,style:{"max-width":"600px"},model:e,rules:Y,"label-width":"auto"},{default:d(()=>[r(m,{label:"选择外出老人",prop:"elderlyName"},{default:d(()=>[r(a,{modelValue:e.elderlyName,"onUpdate:modelValue":l[0]||(l[0]=o=>e.elderlyName=o),disabled:""},null,8,["modelValue"])]),_:1}),r(m,{label:"外出时间",prop:"startTime"},{default:d(()=>[r(U,{modelValue:f.value,"onUpdate:modelValue":l[1]||(l[1]=o=>f.value=o),type:"daterange","range-separator":"-","start-placeholder":"选择开始时间","end-placeholder":"选择结束时间",size:k.value,style:{width:"100%"},onChange:C,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",disabled:i.value},null,8,["modelValue","size","disabled"])]),_:1}),r(m,{label:"陪同人员类型",prop:"relation",placement:"bottom"},{default:d(()=>[r(P,{modelValue:e.relation,"onUpdate:modelValue":l[2]||(l[2]=o=>e.relation=o)},null,8,["modelValue"])]),_:1}),r(m,{label:"陪同人员姓名",prop:"name"},{default:d(()=>[r(a,{modelValue:e.name,"onUpdate:modelValue":l[3]||(l[3]=o=>e.name=o),placeholder:"请输入陪同人员姓名"},null,8,["modelValue"])]),_:1}),r(m,{label:"陪同人员电话",prop:"mobile"},{default:d(()=>[r(a,{modelValue:e.mobile,"onUpdate:modelValue":l[4]||(l[4]=o=>e.mobile=o),placeholder:"请输入11位手机号码"},null,8,["modelValue"])]),_:1}),r(m,{label:"陪同人员地址",prop:"address"},{default:d(()=>[r(a,{modelValue:e.address,"onUpdate:modelValue":l[5]||(l[5]=o=>e.address=o),placeholder:"请输入陪同人员详细地址"},null,8,["modelValue"])]),_:1}),r(m,{label:"外出原因",prop:"content"},{default:d(()=>[r(a,{modelValue:e.content,"onUpdate:modelValue":l[6]||(l[6]=o=>e.content=o),style:{width:"500px"},rows:2,type:"textarea",placeholder:"请输入外出原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),r(x,{size:"small",type:"primary",onClick:O,loading:y.value},{default:d(()=>[i.value?(v(),I(q,{key:0},[_("保存修改")],64)):(v(),I(q,{key:1},[_("保存")],64))]),_:1},8,["loading"]),r(x,{size:"small",onClick:M},{default:d(()=>[...l[7]||(l[7]=[_("取消",-1)])]),_:1})]),_:1})])}}}),le=L(X,[["__scopeId","data-v-0c8ed212"]]);export{le as default};
