import{o as E}from"./oldManRelation-BmOKY2bv.js";import{_ as T}from"./CascaderBeg.vue_vue_type_script_setup_true_lang-_gtH4QnK.js";import{u as Y}from"./Uploads-hqb4toZy.js";import{c as F,d as j}from"./Reserve-s3Ful1lR.js";import{d as A,r as y,z as G,k as R,o as L,c as S,e as t,w as a,b as i,f as b,u as $,g as I,E as p,h as D,M as z,a as O,_ as P}from"./index-DSXWNbz6.js";import"./building-CNUBr-fR.js";import"./convertToTree-Coeds9PE.js";import"./house-0UauvkXi.js";const W={class:"reservation-page"},H={class:"form-section"},J={class:"form-section"},K={class:"form-actions"},Q=A({__name:"ReserveUpd",setup(X){const x="http://123.57.237.81:8080/caresystem-server/api",_="http://123.57.237.81:8080/caresystem/",w=x+"/upload/add",m=y(""),f=G(),U=z();console.log("路由信息：",f);const M=R({name:[{required:!0,message:"请输入预定人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入预定人电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号",trigger:"blur"}],relation:[{required:!0,message:"请选择与老人关系",trigger:"change"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}],days:[{required:!0,message:"请输入预定时长",trigger:"blur"},{type:"number",min:1,message:"时长不能小于1天",trigger:"blur"}],amount:[{required:!0,message:"请输入定金金额",trigger:"blur"},{type:"number",min:0,message:"定金不能为负数",trigger:"blur"}]}),e=R({id:0,elderlyId:0,name:"",mobile:"",relation:"",bed:"",startDate:"",day:0,amount:0,files:[]}),c=y(),d=y(),v=y(!1),k=r=>{e.bed=r[r.length-1]||"",console.log("床位更新：",e.bed)},B=async()=>{const r=f.query.id||f.params.id;console.log("id",r);const l=await F(Number(r));console.log("单条预订信息",l);const o=l.data;e.id=o.id,e.bed=o.bed||"",e.elderlyId=o.elderlyId||0,e.name=o.name||"",e.mobile=o.mobile||"",e.relation=o.relation||"",e.startDate=o.startDate||"",e.day=o.day||0,e.amount=o.amount||0,e.files=o.files||[],o.files&&o.files.length>0&&(m.value=o.files.map(n=>_+n.file).join(","),d.value&&typeof d.value.initFiles=="function"&&d.value.initFiles(o.files))};L(()=>{const r=f.query.elderlyId||f.params.elderlyId;if(console.log("老人id",r),r){const l=Array.isArray(r)?Number(r[0]):Number(r);isNaN(l)||(e.elderlyId=l)}B()});const h=async()=>{if(c.value){try{await c.value.validate()}catch{p.warning("请完善必填项后提交");return}try{await D.confirm("确认要保存修改的预定信息吗？","提交确认",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"})}catch{p.info("已取消提交");return}v.value=!0;try{const r={...e,files:m.value?m.value.split(",").map(o=>({file:o.replace(_,"")})):[]};let l=await j(r);console.log("修改预定登记",l),p.success(e.id?"修改成功":"新增成功"),U.push({path:"/Reserve",query:{elderlyId:e.elderlyId}})}catch(r){console.error("提交预定信息失败：",r),p.error("提交失败，请检查网络或联系管理员")}finally{v.value=!1}}},q=()=>{D.confirm("取消后表单数据将重置，是否确认？","取消操作",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}).then(async()=>{c.value&&c.value.resetFields();const r=e.elderlyId;Object.assign(e,{id:void 0,name:"",mobile:"",relation:"",bed:"",startDate:"",day:null,amount:null,files:[]}),e.elderlyId=r,m.value="",d.value&&typeof d.value.clearFiles=="function"&&d.value.clearFiles(),p.info("已取消当前操作，表单已重置")}).catch(()=>{p.info("已取消重置")}),U.push({path:"/Reserve"})};return(r,l)=>{const o=i("el-input"),n=i("el-form-item"),u=i("el-col"),g=i("el-row"),N=i("el-date-picker"),V=i("el-button"),C=i("el-form");return O(),S("div",W,[t(C,{ref_key:"formRef",ref:c,model:e,rules:M,"label-width":"150px",class:"reservation-form"},{default:a(()=>[b("div",H,[l[8]||(l[8]=b("h3",{class:"section-title"},"预定信息",-1)),t(g,{gutter:20},{default:a(()=>[t(u,{span:12},{default:a(()=>[t(n,{label:"预定人姓名:",prop:"name"},{default:a(()=>[t(o,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=s=>e.name=s),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:a(()=>[t(n,{label:"预定人电话:",prop:"mobile"},{default:a(()=>[t(o,{modelValue:e.mobile,"onUpdate:modelValue":l[1]||(l[1]=s=>e.mobile=s),placeholder:"请输入预定人电话",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(g,{gutter:20},{default:a(()=>[t(u,{span:12},{default:a(()=>[t(n,{label:"与老人关系:",prop:"relation"},{default:a(()=>[t(E,{modelValue:e.relation,"onUpdate:modelValue":l[2]||(l[2]=s=>e.relation=s)},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:a(()=>[t(n,{label:"床位",prop:"bed"},{default:a(()=>[t(T,{onBedChange:k,modelValue:e.bed,"onUpdate:modelValue":l[3]||(l[3]=s=>e.bed=s)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(g,{gutter:20},{default:a(()=>[t(u,{span:12},{default:a(()=>[t(n,{label:"开始日期:",prop:"startDate"},{default:a(()=>[t(N,{modelValue:e.startDate,"onUpdate:modelValue":l[4]||(l[4]=s=>e.startDate=s),type:"date",placeholder:"请选择",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(u,{span:12},{default:a(()=>[t(n,{label:"预定时长（天）:",prop:"day"},{default:a(()=>[t(o,{modelValue:e.day,"onUpdate:modelValue":l[5]||(l[5]=s=>e.day=s),modelModifiers:{number:!0},placeholder:"请输入预定时长",type:"number",clearable:"",min:"1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(g,{gutter:20},{default:a(()=>[t(u,{span:12},{default:a(()=>[t(n,{label:"定金应收:",prop:"amount"},{default:a(()=>[t(o,{modelValue:e.amount,"onUpdate:modelValue":l[6]||(l[6]=s=>e.amount=s),modelModifiers:{number:!0},placeholder:"请输入定金应收",type:"number",clearable:"",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),b("div",J,[l[10]||(l[10]=b("h3",{class:"section-title"},"预定协议",-1)),t(n,{class:"FormWraps",label:"上传图片"},{default:a(()=>[t(Y,{ref_key:"uploadRef",ref:d,modelValue:m.value,"onUpdate:modelValue":l[7]||(l[7]=s=>m.value=s),baseUrl:$(_),uploadUrl:w,isText:!0},{"upload-text":a(()=>[t(V,{type:"primary"},{default:a(()=>[...l[9]||(l[9]=[I("上传图片",-1)])]),_:1})]),_:1},8,["modelValue","baseUrl"])]),_:1})]),b("div",K,[t(V,{type:"primary",loading:v.value,onClick:h},{default:a(()=>[...l[11]||(l[11]=[I(" 保存并提交 ",-1)])]),_:1},8,["loading"]),t(V,{onClick:q},{default:a(()=>[...l[12]||(l[12]=[I("取消",-1)])]),_:1})])]),_:1},8,["model","rules"])])}}}),ne=P(Q,[["__scopeId","data-v-0c90d753"]]);export{ne as default};
