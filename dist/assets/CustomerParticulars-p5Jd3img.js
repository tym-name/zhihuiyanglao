import{d as N,r as n,k as h,l as D,c as V,f as u,e as r,g as R,b as m,w as s,t as q,a as F,_ as k,N as j,Y as B,n as $,U as E,I as S,o as A,z as U,E as w,B as I,u as C,P as J}from"./index-DSXWNbz6.js";import{b as M}from"./customer-s1odyxDc.js";const T={class:"elderly-info-form"},z=N({__name:"CustomerParticulars",props:{idgethomr:{type:Object,default:()=>{}}},emits:["update:elderlyForm","validate","form"],setup(x,{expose:g,emit:c}){let d=x;const t=c,i=n(),o=h({name:"",gender:1,idCard:"",status:""}),b=h({name:[{required:!0,message:"请输入老人姓名",trigger:"blur"}],gender:[{required:!0,message:"请选择老人性别",trigger:"change"}],idCard:[{required:!0,message:"请输入身份证号",trigger:"blur"}],status:[{required:!0,message:"请输入老人状况",trigger:"blur"}]}),f=()=>({...o});D(()=>d.idgethomr,l=>{l&&Object.assign(o,l)});const p=()=>{i.value?.resetFields()};return D(o,l=>{t("update:elderlyForm",l)},{deep:!0}),g({getFormData:f,resetForm:p}),(l,e)=>{const a=m("el-form-item"),y=m("el-form");return F(),V("div",T,[e[0]||(e[0]=u("h3",{class:"form-title"},[u("i",{class:"el-icon-user"}),R(" 老人信息 ")],-1)),r(y,{ref_key:"formRef",ref:i,model:o,rules:b,"label-width":"100px"},{default:s(()=>[r(a,{label:"老人姓名:",prop:"name"},{default:s(()=>[u("div",null,q(o.name),1)]),_:1}),r(a,{label:"老人性别:",prop:"gender"},{default:s(()=>[u("div",null,q(o.gender),1)]),_:1}),r(a,{label:"身份证号:",prop:"idCard"},{default:s(()=>[u("div",null,q(o.idCard),1)]),_:1}),r(a,{label:"老人状况:",prop:"status"},{default:s(()=>[u("div",null,q(o.status),1)]),_:1})]),_:1},8,["model","rules"])])}}}),G=k(z,[["__scopeId","data-v-44e8d050"]]),Y={class:"demand-summary-form"},H=N({__name:"SummaryParticulars",emits:["update:formData","validate"],setup(x,{expose:g,emit:c}){const d=c,t=n(),i=h({roomRequire:"",content:""}),o=h({roomRequire:[{required:!0,message:"请输入老人姓名",trigger:"blur"}],content:[{required:!0,message:"请输入意向描述",trigger:"change"}]}),b=()=>({...i}),f=async()=>{if(!t.value)return!1;try{const l=await t.value.validate();return d("validate",l),l}catch{return d("validate",!1),!1}},p=()=>{t.value?.resetFields()};return D(i,l=>{d("update:formData",l)},{deep:!0}),g({getFormData:b,validate:f,resetForm:p}),(l,e)=>{const a=m("el-form-item"),y=m("el-form");return F(),V("div",Y,[e[0]||(e[0]=u("h3",{class:"form-title"},[u("i",{class:"el-icon-document"}),R(" 需求总结 ")],-1)),r(y,{ref_key:"formRef",ref:t,model:i,rules:o,"label-width":"100px"},{default:s(()=>[r(a,{label:"房间需求:",prop:"roomRequire"},{default:s(()=>[R(q(i.roomRequire),1)]),_:1}),r(a,{label:"意向描述:",prop:"content"},{default:s(()=>[u("div",null,q(i.content),1)]),_:1})]),_:1},8,["model","rules"])])}}}),K=k(H,[["__scopeId","data-v-434efc9e"]]),L=N({__name:"FamilyParticulars",props:{familylist:{type:Array,default:()=>[]}},setup(x,{expose:g}){let c=x;D(()=>c.familylist,e=>{e&&(d.value=e,console.log(p.value))});const d=n(E("familyData")||[]),t=n(!1),i=n(!1),o=n(!1),b=n(),f=h({id:0,elderlyId:0,name:"",mobile:"",idCard:"",relation:"",gender:1,address:""}),p=n({...f}),l=()=>{o.value=!1,i.value=!0,p.value={...f},S(()=>{b.value?.clearValidate()})};return g({data:d}),(e,a)=>{const y=m("el-button"),_=m("el-table-column"),P=m("el-table"),v=B("loading");return F(),V("div",null,[r(y,{style:{"margin-bottom":"10px"},type:"primary",onClick:l},{default:s(()=>[...a[0]||(a[0]=[R("新增家属",-1)])]),_:1}),j((F(),$(P,{border:"",data:d.value,style:{width:"100%"}},{default:s(()=>[r(_,{prop:"id",label:"序号"}),r(_,{prop:"name",label:"姓名"}),r(_,{label:"性别"},{default:s(O=>[R(q(O.row.gender===1?"男":"女"),1)]),_:1}),r(_,{prop:"idCard",label:"身份证号"}),r(_,{prop:"mobile",label:"联系电话"}),r(_,{prop:"address",label:"联系地址"}),r(_,{prop:"relation",label:"与老人的关系"})]),_:1},8,["data"])),[[v,t.value]])])}}}),Q=k(L,[["__scopeId","data-v-f299443c"]]),W={class:"round"},X=N({__name:"CustomerParticulars",setup(x){function g(e){Object.assign(t,e)}const c=U(),d=n(0);let t=h({id:0,name:"",mobile:"",gender:1,birthday:null,status:"",idCard:"",roomRequire:"",content:"",state:1,source:"在线咨询",family:[]});const i=h({name:[{required:!0,message:"请输入老人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号码",trigger:"blur"}],idCard:[{required:!0,message:"请输入身份证号码",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],birthday:[{required:!0,message:"请选择出生日期",trigger:"change"}]});let o=n([]);A(async()=>{const e=c.query.id||c.params.id;if(!e||isNaN(Number(e))){w.error("未获取到有效的老人ID，无法编辑"),I.push("/Customer");return}d.value=Number(e),await l()});let b=Number(c.query.id),f=n(),p=n();const l=async()=>{try{let{data:e}=await M(b);console.log(e),f.value=e,p.value=e.family,Object.assign(t,{id:e.id,name:e.name||"",mobile:e.mobile||"",gender:e.gender||1,birthday:e.birthday||null,status:e.status||"",idCard:e.idCard||"",roomRequire:e.roomRequire||"",content:e.content||"",state:e.state||1,source:e.source||"在线咨询",family:e.family||[]})}catch(e){console.error("获取老人详情失败:",e),w.error("获取老人详情失败")}};return D(o,e=>{e&&Array.isArray(e)&&(t.family=JSON.parse(JSON.stringify(e)))},{deep:!0}),(e,a)=>{const y=m("el-form"),_=m("el-button"),P=m("el-card");return F(),$(P,{class:"elderly-edit-card"},{default:s(()=>[r(y,{ref:"formRef",model:C(t),rules:i,"label-width":"100px",class:"edit-form"},{default:s(()=>[r(G,{modelValue:C(t),"onUpdate:modelValue":a[0]||(a[0]=v=>J(t)?t.value=v:t=v),idgethomr:C(f),onForm:g},null,8,["modelValue","idgethomr"]),r(Q,{modelValue:C(t).family,"onUpdate:modelValue":a[1]||(a[1]=v=>C(t).family=v),familylist:C(p)},null,8,["modelValue","familylist"]),r(K)]),_:1},8,["model","rules"]),u("div",W,[r(_,{onClick:a[2]||(a[2]=v=>C(I).push("/Customer"))},{default:s(()=>[...a[3]||(a[3]=[R("返回",-1)])]),_:1})])]),_:1})}}}),re=k(X,[["__scopeId","data-v-da29dd15"]]);export{re as default};
