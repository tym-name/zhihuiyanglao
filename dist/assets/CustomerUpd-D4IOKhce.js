import{C as S,S as w}from"./Summary-D2-Jib6K.js";import{F as D}from"./Family-DN0_-m15.js";import{d as U,r as l,k as p,o as B,z as F,E as a,B as d,l as I,n as O,w as n,b as f,e as i,f as E,u as o,P as $,g as b,a as j,_ as A}from"./index-DSXWNbz6.js";import{b as J,e as M}from"./customer-s1odyxDc.js";import"./Relation.vue_vue_type_script_setup_true_lang-BFgC7YOg.js";const z={class:"round"},G=U({__name:"CustomerUpd",setup(P){function _(e){Object.assign(r,e)}const m=F(),C=l(0),s=l(!1),v=l();let r=p({id:0,name:"",mobile:"",gender:1,birthday:null,status:"",idCard:"",roomRequire:"",content:"",state:1,source:"在线咨询",family:[]});const h=p({name:[{required:!0,message:"请输入老人姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的11位手机号码",trigger:"blur"}],idCard:[{required:!0,message:"请输入身份证号码",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],birthday:[{required:!0,message:"请选择出生日期",trigger:"change"}]});let q=l([]);B(async()=>{const e=m.query.id||m.params.id;if(!e||isNaN(Number(e))){a.error("未获取到有效的老人ID，无法编辑"),d.push("/Customer");return}C.value=Number(e),await R()});let N=Number(m.query.id),c=l(),g=l();const R=async()=>{try{let{data:e}=await J(N);console.log(e),c.value=e,g.value=e.family,Object.assign(r,{id:e.id,name:e.name||"",mobile:e.mobile||"",gender:e.gender||1,birthday:e.birthday||null,status:e.status||"",idCard:e.idCard||"",roomRequire:e.roomRequire||"",content:e.content||"",state:e.state||1,source:e.source||"在线咨询",family:e.family||[]})}catch(e){console.error("获取老人详情失败:",e),a.error("获取老人详情失败")}},V=async()=>{if(!s.value)try{s.value=!0,console.log(r);const e=await M(r);if(console.log("修改潜在客户返回结果:",e),!e){a.error("修改请求已发送，但服务器未返回任何响应"),s.value=!1;return}if(!(e.data||e)){a.error("服务器返回数据为空，修改失败"),s.value=!1;return}e.code===1e4?(a.success("修改成功"),d.push("/Customer")):a.error("修改失败：未知错误")}catch(e){console.error("修改失败:",e),e.message?a.error(`修改失败：${e.message}`):a.error("修改失败，请重试")}finally{s.value=!1}};return I(q,e=>{e&&Array.isArray(e)&&(r.family=JSON.parse(JSON.stringify(e)))},{deep:!0}),(e,t)=>{const k=f("el-form"),y=f("el-button"),x=f("el-card");return j(),O(x,{class:"elderly-edit-card"},{default:n(()=>[i(k,{ref_key:"formRef",ref:v,model:o(r),rules:h,"label-width":"100px",class:"edit-form"},{default:n(()=>[i(S,{modelValue:o(r),"onUpdate:modelValue":t[0]||(t[0]=u=>$(r)?r.value=u:r=u),idgethomr:o(c),onForm:_},null,8,["modelValue","idgethomr"]),i(D,{modelValue:o(r).family,"onUpdate:modelValue":t[1]||(t[1]=u=>o(r).family=u),familylist:o(g)},null,8,["modelValue","familylist"]),i(w)]),_:1},8,["model","rules"]),E("div",z,[i(y,{onClick:t[2]||(t[2]=u=>o(d).push("/Customer"))},{default:n(()=>[...t[3]||(t[3]=[b("取消",-1)])]),_:1}),i(y,{type:"primary",onClick:V,loading:s.value},{default:n(()=>[...t[4]||(t[4]=[b("保存修改",-1)])]),_:1},8,["loading"])])]),_:1})}}}),W=A(G,[["__scopeId","data-v-ab209d12"]]);export{W as default};
