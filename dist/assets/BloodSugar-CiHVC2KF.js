import{T as M}from"./table-BDVlGf5e.js";import{_ as z,e as H,f as J}from"./ChoseOneElderly.vue_vue_type_script_setup_true_lang-DVl0-9Mk.js";import{D as h,d as $,r,k as K,j as Q,l as A,b as i,c as F,a as w,e as l,w as o,n as W,t as X,g as m,f as E,h as P,E as C,u as Y}from"./index-DSXWNbz6.js";import"./activity-DcouU_la.js";const Z=d=>h.get("/bloodSugar/list",d),ee=d=>h.delete(`/bloodSugar/delete/${d}`),le=d=>h.post("/bloodSugar/deleteAll",d),ae=d=>h.post("/bloodSugar/add",d),oe=d=>h.put("/bloodSugar/update",d),te=d=>h.get(`/bloodSugar/get/${d}`),ne={class:"dialog-footer"},de=$({__name:"addOrUpdateBloodSugar",props:{isShow:{type:Boolean},OpenOrClose:{type:Function},oneBloodSugarData:{},refresh:{type:Function}},setup(d){const u=d,c=r(),p=r(!1),f=r(""),n=r({id:0,elderlyId:0,val:""}),N=K({elderlyId:[{required:!0,message:"请选择老人姓名",trigger:["change","blur"]},{type:"number",min:1,message:"请选择老人姓名",trigger:["change","blur"]}],val:[{required:!0,message:"请输入血糖",trigger:["change","blur"]}]}),x=Q(()=>n.value.id?"修改血糖记录":"添加血糖记录"),I=t=>{P.confirm("你确定要关闭此对话框吗?").then(()=>{t()}).catch(()=>{})},S=()=>{p.value=!0},O=()=>{p.value=!1},T=t=>{f.value=t.name,n.value.elderlyId=t.id,p.value=!1,c.value?.validateField("elderlyId")};A(()=>u.oneBloodSugarData,t=>{u.isShow&&t.id>0&&(f.value=t.elderlyName,n.value.id=t.id,n.value.elderlyId=t.elderlyId,n.value.val=t.val)},{immediate:!0,deep:!0});const V=async()=>{c.value&&await c.value.validate(async t=>{if(t){if(n.value.id){if(!await oe(n.value))return;C.success("修改成功")}else{if(!await ae(n.value))return;C.success("添加成功")}u.OpenOrClose(),u.refresh(),g()}})},g=()=>{c.value?.resetFields(),f.value="",n.value={id:0,elderlyId:0,val:""}};return A(()=>u.isShow,t=>{t||g()}),(t,s)=>{const v=i("el-button"),y=i("el-form-item"),D=i("el-input"),B=i("el-form"),R=i("el-dialog");return w(),F("div",null,[l(R,{modelValue:u.isShow,"onUpdate:modelValue":s[1]||(s[1]=a=>u.isShow=a),title:x.value,width:"500","before-close":I},{footer:o(()=>[E("div",ne,[l(v,{onClick:u.OpenOrClose},{default:o(()=>[...s[3]||(s[3]=[m("取消",-1)])]),_:1},8,["onClick"]),l(v,{type:"primary",onClick:V},{default:o(()=>[...s[4]||(s[4]=[m("确认",-1)])]),_:1})])]),default:o(()=>[l(B,{ref_key:"ruleFormRef",ref:c,style:{"max-width":"600px"},model:n.value,rules:N,"label-width":"auto"},{default:o(()=>[l(y,{label:"老人姓名",prop:"elderlyId"},{default:o(()=>[n.value.elderlyId&&n.value.elderlyId>0?(w(),F("span",{key:0,onClick:S},X(f.value),1)):(w(),W(v,{key:1,type:"primary",onClick:S},{default:o(()=>[...s[2]||(s[2]=[m("选择老人",-1)])]),_:1}))]),_:1}),l(y,{label:"血糖",prop:"val"},{default:o(()=>[l(D,{modelValue:n.value.val,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.val=a),placeholder:"请输入血糖"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(z,{isShow:p.value,openElderly:S,closeElderly:O,onSelectElderly:T},null,8,["isShow"])])}}}),ce=$({__name:"BloodSugar",setup(d){const u=r(null),c=()=>{u.value.refresh()},p=r(!1),f=()=>{p.value=!p.value,y.value={id:0,companyId:0,elderlyId:0,addTime:"",addAccountId:0,val:"",begId:0,begName:null,idCard:null,addAccountName:"",addAccountPhoto:null,elderlyName:"",elderlyPhoto:null,elderlyGender:null,elderlyIdCard:null,houseName:null,buildingName:"",staffId:0,staffName:null,staffPhoto:null}},n=a=>{P.confirm("是否删除该条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await ee(a),C({type:"success",message:"删除成功"}),c()})},N=r(!0),x=r([]),I=r([]),S=a=>{x.value=a,I.value=a.map(e=>e.id),N.value=a.length===0},O=async()=>{P.confirm("是否删除多条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let a=await le(I.value);console.log(a),a.code===1e4&&(C({type:"success",message:"删除成功"}),c())}).catch(()=>{C({type:"info",message:"取消删除"})})},T=()=>{u.value.refresh()},V=[{type:"selection",width:"50"},{label:"序号",prop:"id"},{label:"统计日期",prop:"addTime"},{label:"记录人",prop:"addAccountName"},{label:"老人姓名",prop:"elderlyName"},{label:"床位",prop:"begName"},{label:"血糖",prop:"val"},{label:"操作",width:160,slot:"operate",fixed:"right"}],g=r({name:"",begId:null}),t=()=>{T()},s=()=>{g.value={name:"",begId:null},v.value=[]},v=r([]);A(()=>v.value,a=>{g.value.begId=a[a.length-1]});const y=r({id:0,companyId:0,elderlyId:0,addTime:"",addAccountId:0,val:"",begId:0,begName:null,idCard:null,addAccountName:"",addAccountPhoto:null,elderlyName:"",elderlyPhoto:null,elderlyGender:null,elderlyIdCard:null,houseName:null,buildingName:"",staffId:0,staffName:null,staffPhoto:null}),D=async a=>{f();let e=await te(a);console.log("获取单条数据",e),e&&e.data&&(y.value=e.data)},B=r([]);return(async()=>{try{let a=await H();console.log("楼栋列表",a);const e=a.data.list||[];B.value=J(e)}catch(a){console.error("获取床位数据失败：",a),B.value=[]}})(),(a,e)=>{const L=i("el-input"),k=i("el-form-item"),U=i("el-cascader"),j=i("el-date-picker"),b=i("el-button"),q=i("el-form");return w(),F("div",null,[l(M,{ref_key:"tableRef",ref:u,columns:V,"fetch-data":Y(Z),"init-params":g.value,onSelectionChange:S},{search:o(()=>[l(q,{inline:!0,class:"demo-form-inline"},{default:o(()=>[l(k,{label:"老人:"},{default:o(()=>[l(L,{placeholder:"请输入老人姓名",clearable:"",modelValue:g.value.name,"onUpdate:modelValue":e[0]||(e[0]=_=>g.value.name=_)},null,8,["modelValue"])]),_:1}),l(k,{label:"床位:"},{default:o(()=>[l(U,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=_=>v.value=_),options:B.value,clearable:"",placeholder:"请选择床位"},null,8,["modelValue","options"])]),_:1}),l(k,{label:"巡检时间:"},{default:o(()=>[l(j,{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}})]),_:1}),l(k,null,{default:o(()=>[l(b,{type:"primary",onClick:t},{default:o(()=>[...e[2]||(e[2]=[m("查询",-1)])]),_:1}),l(b,{onClick:s},{default:o(()=>[...e[3]||(e[3]=[m("重置",-1)])]),_:1})]),_:1})]),_:1})]),buttons:o(()=>[l(b,{type:"success",onClick:f},{default:o(()=>[...e[4]||(e[4]=[m("增加",-1)])]),_:1}),l(b,{type:"danger",onClick:O},{default:o(()=>[...e[5]||(e[5]=[m("批量删除",-1)])]),_:1})]),operate:o(({row:_})=>[l(b,{link:"",type:"primary",onClick:G=>D(_.id)},{default:o(()=>[...e[6]||(e[6]=[E("i",{class:"iconfont icon-bianji"},null,-1),m(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(b,{link:"",type:"danger",onClick:G=>n(_.id)},{default:o(()=>[...e[7]||(e[7]=[E("i",{class:"iconfont icon-shanchu"},null,-1),m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["fetch-data","init-params"]),l(de,{isShow:p.value,OpenOrClose:f,oneBloodSugarData:y.value,refresh:c},null,8,["isShow","oneBloodSugarData"])])}}});export{ce as default};
