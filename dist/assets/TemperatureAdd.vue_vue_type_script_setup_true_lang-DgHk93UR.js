import R from"./TemperatureSelect-Cfwk2-k6.js";import{c as U}from"./temperature-D_kE8odB.js";import{d as $,m as q,r as u,i as L,k as v,b as r,c as i,a as c,e as o,w as s,f as _,p as V,t as x,F as D,v as H,g as f,E as p}from"./index-DSXWNbz6.js";const O={style:{display:"flex","align-items":"center",gap:"10px"}},j={key:0,style:{color:"#666","min-width":"150px"}},z={class:"dialog-footer"},P=$({__name:"TemperatureAdd",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:q(["addRefresh"],["update:modelValue"]),setup(N,{emit:b}){const y=u(!1),k=b,C=u(1),d=L(N,"modelValue"),n=u(!1),e=v({elderlyId:0,elderlyName:"",val:"",staffId:C.value}),I=a=>{n.value=!1,a&&(e.elderlyId=a.elderlyId||0,e.elderlyName=a.elderlyName||"")},w=v({elderlyName:[{required:!0,message:"请选择老人姓名",trigger:"change"}],val:[{required:!0,message:"请输入体温",trigger:"blur"},{pattern:/^\d+(\.\d+)?$/,message:"请输入有效的体温数值（如：37.5）",trigger:"blur"}]}),B=()=>{n.value=!0},F=()=>{e.val=e.val.replace(/[^\d.]/g,"")},S=async()=>{try{const a={elderlyId:e.elderlyId,val:e.val,staffId:e.staffId},l=await U(a);l&&[200,0,1e4].includes(l.code)?(p.success("体温记录添加成功！"),d.value=!1,T()):p.error(l?.msg||"添加失败：接口返回异常")}catch(a){console.error("添加体温记录失败：",a),p.error(`添加失败：${a.message||"网络异常，请稍后重试"}`)}finally{y.value=!1}k("addRefresh")},T=()=>{e.elderlyId=0,e.elderlyName="",e.val=""},h=[{type:"primary",text:"选择老人"}];return(a,l)=>{const m=r("el-button"),g=r("el-form-item"),A=r("el-input"),M=r("el-form"),E=r("el-dialog");return c(),i("div",null,[o(E,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=t=>d.value=t),title:"增加体温记录",width:"500","close-on-click-modal":!1},{footer:s(()=>[_("div",z,[o(m,{onClick:l[1]||(l[1]=t=>d.value=!1)},{default:s(()=>[...l[4]||(l[4]=[f("取消",-1)])]),_:1}),o(m,{type:"primary",onClick:S,loading:y.value},{default:s(()=>[...l[5]||(l[5]=[f(" 提交 ",-1)])]),_:1},8,["loading"])])]),default:s(()=>[o(M,{ref:"ruleFormRef",style:{"max-width":"600px"},model:e,rules:w,"label-width":"auto"},{default:s(()=>[o(g,{label:"老人姓名",prop:"elderlyName"},{default:s(()=>[_("div",O,[e.elderlyName?(c(),i("span",j,x(e.elderlyName),1)):V("",!0),e.elderlyName?V("",!0):(c(),i(D,{key:1},H(h,t=>o(m,{onClick:B,key:t.text,type:t.type,text:"",bg:""},{default:s(()=>[f(x(t.text),1)]),_:2},1032,["type"])),64))])]),_:1}),o(g,{label:"体温",prop:"val"},{default:s(()=>[o(A,{modelValue:e.val,"onUpdate:modelValue":l[0]||(l[0]=t=>e.val=t),placeholder:"请输入体温（如：37.5）",suffix:"°C",onBlur:F},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(R,{onHandleSuccess2:I,modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=t=>n.value=t)},null,8,["modelValue"])])}}});export{P as _};
