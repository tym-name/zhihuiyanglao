import{m as I,d as V}from"./role-B3fOHZeG.js";import{d as E,o as L,r as _,E as m,k as p,c as M,e as t,w as l,b as s,g as f,B as R,a as B}from"./index-DSXWNbz6.js";const A=E({__name:"RoleEdit",setup(D){L(()=>{h()});const d=_([]),c=_([]),u=(e,o=0)=>e.filter(a=>a.pid===o).map(a=>{const r=u(e,a.id);return{...a,children:r.length>0?r:[]}}),h=async()=>{try{const e=await I();console.log("权限列表",e),e.data&&e.data.list&&(d.value=e.data.list,c.value=u(d.value))}catch(e){console.error("获取权限列表失败：",e),m.error("加载权限列表失败，请刷新重试")}},n=p({id:0,name:"",menuIds:[]}),k=(e,o)=>{n.menuIds=o.checkedKeys,console.log("选中的权限ID：",n.menuIds)},y={label:"name",children:"children"},b=p({name:""}),v=async()=>{try{const e=await V(n);console.log("添加角色结果",e),e.code===200&&(m.success("添加角色成功"),n.name="",n.menuIds=[],c.value=u(d.value),R.push("/Role"))}catch(e){console.error("添加角色失败：",e),m.error("添加角色失败，请重试")}};return(e,o)=>{const a=s("el-input"),r=s("el-form-item"),w=s("el-form"),x=s("el-tree"),i=s("el-button"),g=s("el-card");return B(),M("div",null,[t(g,{style:{"max-width":"100%"}},{default:l(()=>[t(w,{model:b,"label-width":"auto",style:{"max-width":"400px"}},{default:l(()=>[t(r,{label:"角色名称"},{default:l(()=>[t(a,{modelValue:n.name,"onUpdate:modelValue":o[0]||(o[0]=C=>n.name=C)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t(r,{label:"权限配置"},{default:l(()=>[t(x,{ref:"treeRef",data:c.value,"show-checkbox":"","node-key":"id","default-expand-all":"",props:y,"checked-keys":n.menuIds,onCheck:k},null,8,["data","checked-keys"])]),_:1}),t(r,null,{default:l(()=>[t(i,null,{default:l(()=>[...o[1]||(o[1]=[f("关闭",-1)])]),_:1}),t(i,{type:"primary",onClick:v},{default:l(()=>[...o[2]||(o[2]=[f("确定",-1)])]),_:1})]),_:1})]),_:1})])}}});export{A as default};
