import{t as a,d as k,r as f,l as P,k as x,c as L,e as r,a as c,w as s,u as B,V as E,g as _,v as S,f as V,E as U,h as p,b as D}from"./index-D6YPj1KB.js";const A=l=>a.get("/foods/list",l),M=l=>a.get("/supplier/list",l),R=l=>a.post("/foods/add",l),N=l=>a.put("/foodprice/update",l),$=l=>a.get(`/foodprice/list/${l}`),z=l=>a.put("/foods/update",l),j=l=>a.delete(`/foods/delete/${l}`),G=l=>a.post("/foods/deleteAll",l),q={class:"dialog-footer"},H=k({__name:"priceupdate",props:{isShow:{type:Boolean},close:{type:Function},id:{},foodPrice:{}},emits:["refreshList"],setup(l,{emit:b}){const i=l,v=b,w=e=>{U.confirm("您确定要关闭此对话框吗").then(()=>{e()}).catch(()=>{})},g=f(new Date().toLocaleDateString("zh-CN").replace(/\//g,"-")),d=f(),o=f({id:0,foodId:0,wholePrice:null,sellPrice:null,purchasePrice:null});P(()=>i.id,e=>{e&&(o.value.id=e,o.value.foodId=e)},{immediate:!0}),P(()=>i.foodPrice,e=>{e&&(o.value={...e},e.updateTime&&(g.value=e.updateTime))},{immediate:!0});const y=x({wholePrice:[{required:!0,message:"请输入批发价",trigger:"blur"}],sellPrice:[{required:!0,message:"请输入零售价",trigger:"blur"}],purchasePrice:[{required:!0,message:"请输入采购价",trigger:"blur"}]}),F=async()=>{if(d.value){try{if(!await d.value.validate())return}catch{p.error("表单校验失败，请检查填写内容");return}try{let e=await N(o.value);console.log("价格更新",e),e.code===1e4?(p.success("更新成功"),v("refreshList"),i.close(),o.value.wholePrice=null,o.value.sellPrice=null,o.value.purchasePrice=null,d.value?.resetFields(),v("refreshList")):p.error("更新失败："+(e.msg||"服务器异常"))}catch(e){p.error("更新失败：网络异常"),console.error("更新食材价格报错：",e)}}};return(e,t)=>{const n=c("el-form-item"),m=c("el-input"),h=c("el-button"),C=c("el-dialog");return D(),L("div",null,[r(C,{modelValue:i.isShow,"onUpdate:modelValue":t[3]||(t[3]=u=>i.isShow=u),title:"价格更新",width:"500","before-close":w},{footer:s(()=>[_("div",q,[r(h,{onClick:i.close},{default:s(()=>[...t[4]||(t[4]=[V("取消",-1)])]),_:1},8,["onClick"]),r(h,{type:"primary",onClick:F},{default:s(()=>[...t[5]||(t[5]=[V(" 提交 ",-1)])]),_:1})])]),default:s(()=>[r(B(E),{ref_key:"ruleFormRef",ref:d,style:{"max-width":"600px"},model:o.value,rules:y,"label-width":"auto"},{default:s(()=>[r(n,{label:"更新时间: "},{default:s(()=>[_("span",null,S(g.value),1)]),_:1}),r(n,{label:"批发价",prop:"wholePrice"},{default:s(()=>[r(m,{modelValue:o.value.wholePrice,"onUpdate:modelValue":t[0]||(t[0]=u=>o.value.wholePrice=u)},null,8,["modelValue"])]),_:1}),r(n,{label:"零售价",prop:"sellPrice"},{default:s(()=>[r(m,{modelValue:o.value.sellPrice,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.sellPrice=u)},null,8,["modelValue"])]),_:1}),r(n,{label:"采购价",prop:"purchasePrice"},{default:s(()=>[r(m,{modelValue:o.value.purchasePrice,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.purchasePrice=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});export{$ as F,H as _,R as a,G as b,j as d,A as f,M as s,z as u};
