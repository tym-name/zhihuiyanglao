import{T as j}from"./table-BDVlGf5e.js";import{_ as G,u as M,a as z,g as H,d as J,b as K,c as Q,e as W,f as X}from"./ChoseOneElderly.vue_vue_type_script_setup_true_lang-DVl0-9Mk.js";import{d as E,r as d,k as Y,j as Z,l as V,b as u,c as F,a as N,e as l,w as o,n as ee,t as le,g as c,f as O,h as T,E as B,u as oe,F as ae}from"./index-DSXWNbz6.js";import"./activity-DcouU_la.js";const te={class:"dialog-footer"},se=E({__name:"addOrUpdateBlood",props:{isShow:{type:Boolean},OpenOrClose:{type:Function},oneBloodData:{},refresh:{type:Function}},setup(D){const r=D,i=d(),p=d(!1),m=d(""),t=d({id:0,elderlyId:null,bloodPressure:"",pulse:""}),w=Y({elderlyId:[{required:!0,message:"请选择老人姓名",trigger:["change","blur"]}],bloodPressure:[{required:!0,message:"请输入血压",trigger:["change","blur"]}],pulse:[{required:!0,message:"请输入脉搏",trigger:["change","blur"]}]}),P=Z(()=>t.value.id?"修改血压记录":"添加血压记录"),C=s=>{T.confirm("你确定要关闭此对话框吗?").then(()=>{s()}).catch(()=>{})},_=()=>{p.value=!0},S=()=>{p.value=!1},x=s=>{m.value=s.name,t.value.elderlyId=s.id,p.value=!1,i.value?.validateField("elderlyId")};V(()=>r.oneBloodData,s=>{r.isShow&&s.id>0&&(m.value=s.elderlyName,t.value.id=s.id,t.value.elderlyId=s.elderlyId,t.value.bloodPressure=s.bloodPressure,t.value.pulse=s.pulse)},{immediate:!0,deep:!0});const y=async()=>{i.value&&await i.value.validate(async s=>{if(s){if(t.value.id){if(!await M(t.value))return;B.success("修改成功")}else{if(!await z(t.value))return;B.success("添加成功")}r.OpenOrClose(),r.refresh(),I()}})},I=()=>{i.value?.resetFields(),m.value="",t.value={id:0,elderlyId:null,bloodPressure:"",pulse:""}};return V(()=>r.isShow,s=>{s||I()}),(s,n)=>{const h=u("el-button"),f=u("el-form-item"),v=u("el-input"),A=u("el-form"),a=u("el-dialog");return N(),F("div",null,[l(a,{modelValue:r.isShow,"onUpdate:modelValue":n[2]||(n[2]=e=>r.isShow=e),title:P.value,width:"500","before-close":C},{footer:o(()=>[O("div",te,[l(h,{onClick:r.OpenOrClose},{default:o(()=>[...n[4]||(n[4]=[c("取消",-1)])]),_:1},8,["onClick"]),l(h,{type:"primary",onClick:y},{default:o(()=>[...n[5]||(n[5]=[c("确认",-1)])]),_:1})])]),default:o(()=>[l(A,{ref_key:"ruleFormRef",ref:i,style:{"max-width":"600px"},model:t.value,rules:w,"label-width":"auto"},{default:o(()=>[l(f,{label:"老人姓名",prop:"elderlyId"},{default:o(()=>[t.value.elderlyId&&t.value.elderlyId>0?(N(),F("span",{key:0,onClick:_},le(m.value),1)):(N(),ee(h,{key:1,type:"primary",onClick:_},{default:o(()=>[...n[3]||(n[3]=[c("选择老人",-1)])]),_:1}))]),_:1}),l(f,{label:"血压",prop:"bloodPressure"},{default:o(()=>[l(v,{modelValue:t.value.bloodPressure,"onUpdate:modelValue":n[0]||(n[0]=e=>t.value.bloodPressure=e),placeholder:"请输入血压"},null,8,["modelValue"])]),_:1}),l(f,{label:"脉搏",prop:"pulse"},{default:o(()=>[l(v,{modelValue:t.value.pulse,"onUpdate:modelValue":n[1]||(n[1]=e=>t.value.pulse=e),placeholder:"请输入脉搏"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(G,{isShow:p.value,openElderly:_,closeElderly:S,onSelectElderly:x},null,8,["isShow"])])}}}),ie=E({__name:"Blood",setup(D){const r=d(null),i=()=>{r.value.refresh()},p=d(!1),m=()=>{p.value=!p.value,n.value={id:0,addTime:"",addAccountName:"",elderlyName:"",begName:"",bloodPressure:"",pulse:"",companyId:0,elderlyId:0,addAccountId:0,begId:0,idCard:"",addAccountPhoto:null,elderlyPhoto:"",elderlyGender:"",elderlyIdCard:"",houseName:null,buildingName:"",staffId:0,staffName:"",staffPhoto:""}},t=a=>{T.confirm("是否删除该条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await J(a),B({type:"success",message:"删除成功"}),i()})},w=d(!0),P=d([]),C=d([]),_=a=>{P.value=a,C.value=a.map(e=>e.id),w.value=a.length===0},S=async()=>{T.confirm("是否删除多条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let a=await K(C.value);console.log(a),a.code===1e4&&(B({type:"success",message:"删除成功"}),i())}).catch(()=>{B({type:"info",message:"取消删除"})})},x=[{type:"selection",width:"50"},{label:"序号",prop:"id"},{label:"统计日期",prop:"addTime"},{label:"记录人",prop:"addAccountName"},{label:"老人姓名",prop:"elderlyName"},{label:"床位",prop:"begName"},{label:"血压",prop:"bloodPressure"},{label:"脉搏",prop:"pulse"},{label:"操作",width:160,slot:"operate",fixed:"right"}],y=d({staffName:"",id:null,name:"",begId:null}),I=()=>{i()},s=()=>{y.value={staffName:"",id:null,name:"",begId:null},f.value=[]},n=d({id:0,addTime:"",addAccountName:"",elderlyName:"",begName:"",bloodPressure:"",pulse:"",companyId:0,elderlyId:0,addAccountId:0,begId:0,idCard:"",addAccountPhoto:null,elderlyPhoto:"",elderlyGender:"",elderlyIdCard:"",houseName:null,buildingName:"",staffId:0,staffName:"",staffPhoto:""}),h=async a=>{m();let e=await Q(a);console.log("获取单条数据",e),e&&e.data&&(n.value=e.data)},f=d([]);V(()=>f.value,a=>{y.value.begId=a[a.length-1]});const v=d([]);return(async()=>{try{let a=await W();console.log("楼栋列表",a);const e=a.data.list||[];v.value=X(e)}catch(a){console.error("获取床位数据失败：",a),v.value=[]}})(),(a,e)=>{const R=u("el-input"),k=u("el-form-item"),U=u("el-cascader"),L=u("el-date-picker"),b=u("el-button"),$=u("el-form");return N(),F(ae,null,[l(j,{ref_key:"tableRef",ref:r,columns:x,"fetch-data":oe(H),"init-params":y.value,onSelectionChange:_},{search:o(()=>[l($,{inline:!0,class:"demo-form-inline"},{default:o(()=>[l(k,{label:"老人:"},{default:o(()=>[l(R,{placeholder:"请输入老人姓名",clearable:"",modelValue:y.value.name,"onUpdate:modelValue":e[0]||(e[0]=g=>y.value.name=g)},null,8,["modelValue"])]),_:1}),l(k,{label:"床位:"},{default:o(()=>[l(U,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=g=>f.value=g),options:v.value,clearable:"",placeholder:"请选择床位"},null,8,["modelValue","options"])]),_:1}),l(k,{label:"巡检时间:"},{default:o(()=>[l(L,{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期",style:{width:"240px"}})]),_:1}),l(k,null,{default:o(()=>[l(b,{type:"primary",onClick:I},{default:o(()=>[...e[2]||(e[2]=[c("查询",-1)])]),_:1}),l(b,{onClick:s},{default:o(()=>[...e[3]||(e[3]=[c("重置",-1)])]),_:1})]),_:1})]),_:1})]),buttons:o(()=>[l(b,{type:"success",onClick:m},{default:o(()=>[...e[4]||(e[4]=[c("增加",-1)])]),_:1}),l(b,{type:"danger",onClick:S},{default:o(()=>[...e[5]||(e[5]=[c("批量删除",-1)])]),_:1})]),operate:o(({row:g})=>[l(b,{link:"",type:"primary",onClick:q=>h(g.id)},{default:o(()=>[...e[6]||(e[6]=[O("i",{class:"iconfont icon-bianji"},null,-1),c(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(b,{link:"",type:"danger",onClick:q=>t(g.id)},{default:o(()=>[...e[7]||(e[7]=[O("i",{class:"iconfont icon-shanchu"},null,-1),c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["fetch-data","init-params"]),l(se,{isShow:p.value,OpenOrClose:m,oneBloodData:n.value,refresh:i},null,8,["isShow","oneBloodData"])],64)}}});export{ie as default};
