import{T as U}from"./table-B1my3jl3.js";import{s as j,u as M,a as z,f as J,_ as Q,d as G,b as H,F as K}from"./priceupdate.vue_vue_type_script_setup_true_lang-BCtSB-ej.js";import{d as A,r,l as W,k as X,a as f,n as $,b as _,w as n,e as t,u as O,V as Y,c as T,F as E,x as q,g as h,f as m,h as c,E as N,Q as Z,_ as ee}from"./index-D6YPj1KB.js";const le={class:"dialog-footer"},oe=A({__name:"foodadd",props:{isShow:{type:Boolean},close:{type:Function},food:{}},emits:["refreshList"],setup(x,{emit:k}){const V=r("新增食材"),g=r("修改食材"),d=x,w=k,u=r(),v=e=>{N.confirm("您确定要关闭此对话框吗").then(()=>{b(),e()}).catch(()=>{})},s=r({id:null,name:"",unit:"",supplierId:null}),b=()=>{u.value&&(u.value.clearValidate(),u.value.resetFields()),s.value={id:0,name:"",unit:"",supplierId:null}};W(()=>d.food,e=>{e&&e.id?Object.assign(s.value,{id:e.id||0,name:e.name||"",unit:e.unit||"",supplierId:e.supplierId||null}):s.value={id:0,name:"",unit:"",supplierId:null}},{immediate:!0});const P=X({name:[{required:!0,message:"请输入物料名称",trigger:"blur"}],unit:[{required:!0,message:"请选择单位",trigger:"change"}],supplierId:[{required:!0,message:"请选择供应商",trigger:"change"}]}),S=r({page:1,pageSize:10}),C=r([]);(async()=>{let e=await j(S.value);console.log("供应商列表",e),C.value=e.data.list})();const L=[{value:"斤",label:"斤"},{value:"吨",label:"吨"},{value:"个",label:"个"},{value:"克",label:"克"}],F=async()=>{if(u.value){try{if(!await u.value.validate())return}catch{c.error("表单校验失败，请检查填写内容");return}if(s.value.id)try{let e=await M(s.value);console.log("修改",e),e.code===1e4?(c.success("修改成功"),w("refreshList"),d.close(),s.value={id:0,name:"",unit:"",supplierId:null},u.value?.resetFields()):c.error("修改失败："+(e.msg||"服务器异常"))}catch(e){c.error("修改失败：网络异常"),console.error("修改食材报错：",e)}else try{let e=await z(s.value);console.log("添加",e),e.code===1e4?(c.success("添加成功"),w("refreshList"),d.close(),s.value={id:0,name:"",unit:"",supplierId:null},u.value?.resetFields()):c.error("添加失败："+(e.msg||"服务器异常"))}catch(e){c.error("添加失败：网络异常"),console.error("新增食材报错：",e)}}};return(e,i)=>{const B=f("el-input"),y=f("el-form-item"),I=f("el-option"),l=f("el-select"),o=f("el-button"),p=f("el-dialog");return _(),$(p,{modelValue:d.isShow,"onUpdate:modelValue":i[3]||(i[3]=a=>d.isShow=a),title:s.value.id==0?V.value:g.value,width:"500","before-close":v},{footer:n(()=>[h("div",le,[t(o,{onClick:x.close},{default:n(()=>[...i[4]||(i[4]=[m("取消",-1)])]),_:1},8,["onClick"]),t(o,{type:"primary",onClick:F},{default:n(()=>[...i[5]||(i[5]=[m(" 提交 ",-1)])]),_:1})])]),default:n(()=>[t(O(Y),{ref_key:"ruleFormRef",ref:u,style:{"max-width":"600px"},model:s.value,rules:P,"label-width":"auto"},{default:n(()=>[t(y,{label:"物料名称",prop:"name"},{default:n(()=>[t(B,{modelValue:s.value.name,"onUpdate:modelValue":i[0]||(i[0]=a=>s.value.name=a)},null,8,["modelValue"])]),_:1}),t(y,{label:"单位",prop:"unit"},{default:n(()=>[t(l,{modelValue:s.value.unit,"onUpdate:modelValue":i[1]||(i[1]=a=>s.value.unit=a),placeholder:"请选择"},{default:n(()=>[(_(),T(E,null,q(L,a=>t(I,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"供应商",prop:"supplierId"},{default:n(()=>[t(l,{modelValue:s.value.supplierId,"onUpdate:modelValue":i[2]||(i[2]=a=>s.value.supplierId=a),placeholder:"请选择"},{default:n(()=>[(_(!0),T(E,null,q(C.value,a=>(_(),$(I,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),ae=A({__name:"Food",setup(x){const k=r(null),V=[{type:"selection",width:"50"},{label:"序号",prop:"id"},{label:"物料名称",prop:"name"},{label:"单位",prop:"unit"},{label:"供应商",prop:"supplierName"},{label:"批发价",prop:"wholePrice"},{label:"零售价",prop:"sellPrice"},{label:"采购价",prop:"purchasePrice"},{label:"价格更新日期",prop:"updateTime"},{label:"操作",width:320,slot:"operate",fixed:"right"}],g=r({id:0,companyId:0,name:"",unit:"",supplierId:0,wholePrice:null,sellPrice:null,purchasePrice:null,updateTime:null,supplierName:""}),d=r(!1),w=()=>{d.value=!1},u=async()=>{k.value?.refresh()};u();const v=r(!1),s=()=>{v.value=!1},b=r(0),P=async()=>{let l=await K(b.value);console.log("价格列表",l)},S=l=>{v.value=!v.value,b.value=l,P()},C=l=>{d.value=!d.value,g.value=l},R=()=>{d.value=!d.value,g.value={id:0,companyId:0,name:"",unit:"",supplierId:0,wholePrice:null,sellPrice:null,purchasePrice:null,updateTime:null,supplierName:""}},L=l=>{N.confirm("是否删除该条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let o=await G(l);console.log(o),o.code===1e4&&(c({type:"success",message:"删除成功"}),u())}).catch(()=>{c({type:"info",message:"取消删除"})})},F=r(!0),e=r([]),i=r([]),B=l=>{e.value=l,i.value=l.map(o=>o.id),F.value=l.length===0},y=async()=>{N.confirm("是否删除多条记录？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let l=await H(i.value);console.log(l),l.code===1e4&&(c({type:"success",message:"删除成功"}),u())}).catch(()=>{c({type:"info",message:"取消删除"})})},I=l=>{sessionStorage.setItem("foodDetails",JSON.stringify(l)),Z.push("/priceanalysis")};return(l,o)=>{const p=f("el-button");return _(),T("div",null,[t(U,{ref_key:"tableRef",ref:k,columns:V,"fetch-data":O(J),onSelectionChange:B},{buttons:n(()=>[t(p,{type:"success",onClick:R},{default:n(()=>[...o[0]||(o[0]=[m("添加",-1)])]),_:1}),t(p,{type:"danger",onClick:y,disabled:F.value},{default:n(()=>[...o[1]||(o[1]=[m("批量删除",-1)])]),_:1},8,["disabled"])]),operate:n(({row:a})=>[t(p,{link:"",type:"primary",onClick:D=>C(a)},{default:n(()=>[...o[2]||(o[2]=[h("i",{class:"iconfont icon-bianji"},null,-1),m(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"primary",onClick:D=>S(a.id)},{default:n(()=>[...o[3]||(o[3]=[h("i",{class:"iconfont icon-xiangqing"},null,-1),m(" 价格更新 ",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"primary",onClick:D=>I(a)},{default:n(()=>[...o[4]||(o[4]=[h("i",{class:"iconfont icon-fenxi"},null,-1),m(" 价格分析 ",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"danger",onClick:D=>L(a.id)},{default:n(()=>[...o[5]||(o[5]=[h("i",{class:"iconfont icon-shanchu"},null,-1),m(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1},8,["fetch-data"]),t(oe,{isShow:d.value,close:w,onRefreshList:u,food:g.value},null,8,["isShow","food"]),t(Q,{isShow:v.value,close:s,onRefreshList:u,id:b.value},null,8,["isShow","id"])])}}}),ie=ee(ae,[["__scopeId","data-v-bfeb5f6d"]]);export{ie as default};
