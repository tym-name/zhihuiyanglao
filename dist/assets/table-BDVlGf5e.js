import{d as H,r as c,k as L,j as C,o as R,c as m,n as d,p as _,e as P,w as i,b as u,X as b,N as q,f as E,Y as X,F as Z,v as A,Z as G,a as r,$ as J,g as K,t as O,C as Q,_ as ee}from"./index-DSXWNbz6.js";const te={class:"table-container"},ae={key:0,class:"table-actions"},se={key:1},re={class:"pagination-wrapper"},ne=H({__name:"table",props:{columns:{default:()=>[]},hasSearch:{type:Boolean,default:!0},width:{default:"100%"},pageSizes:{default:()=>[10,20,50,100]},initParams:{default:()=>({})},fetchData:{},showSelectionColumn:{type:Boolean,default:!1},autoInit:{type:Boolean,default:!0}},emits:["selection-change","load-success","load-fail"],setup(p,{expose:x,emit:D}){const o=p,v=D,w=c(),y=c(!1),g=c([]),f=c(0),s=L({currentPage:1,pageSize:o.pageSizes[0]}),S=c({}),B=C(()=>o.width==="100%"?"100%":`${o.width}px`),$=C(()=>({page:s.currentPage,pageSize:s.pageSize,...o.initParams,...S.value})),T=(e,a="YYYY-MM-DD HH:mm:ss")=>{if(!e)return"-";try{return Q(e).format(a)}catch(h){return console.warn("时间格式化失败:",h),"-"}},z=e=>e?e.startsWith("http")||e.startsWith("//")?e:"http://123.57.237.81:8080/caresystem/"+e:"",l=async(e=!1)=>{e&&(s.currentPage=1),y.value=!0;try{const a=await o.fetchData({...$.value});console.log(111,a),g.value=a.data?.list||a.list||[],f.value=a.data?.counts||a.counts||0,v("load-success",g.value)}catch(a){console.error("表格数据加载失败:",a),g.value=[],f.value=0,v("load-fail",a)}finally{y.value=!1}},N=e=>{e&&(S.value=e),l(!0)},Y=()=>{w.value?.clearSelection()},I=e=>{s.pageSize=e,l()},V=e=>{s.currentPage=e,l()},W=e=>{v("selection-change",e)};return R(()=>{o.autoInit&&l()}),x({refresh:N,getData:l,clearSelection:Y,tableRef:w}),(e,a)=>{const h=u("el-card"),k=u("el-table-column"),j=u("el-image"),M=u("el-table"),U=u("el-pagination"),F=X("loading");return r(),m("div",te,[e.$slots.search?(r(),d(h,{key:0,class:"search-card",shadow:"never"},{default:i(()=>[b(e.$slots,"search",{},void 0,!0)]),_:3})):_("",!0),P(h,{class:"table-card",shadow:"never"},{default:i(()=>[e.$slots.buttons?(r(),m("div",ae,[b(e.$slots,"buttons",{},void 0,!0)])):_("",!0),q((r(),d(M,{ref_key:"tableRef",ref:w,onSelectionChange:W,data:g.value,style:G({width:B.value}),stripe:""},{default:i(()=>[p.showSelectionColumn?(r(),d(k,{key:0,type:"selection",width:"55",fixed:"left"})):_("",!0),(r(!0),m(Z,null,A(p.columns,t=>(r(),d(k,{key:t.prop||t.label,type:t.type,fixed:t.fixed,prop:t.prop,label:t.label,width:t.width,"min-width":t.minWidth,align:t.align||"center"},J({_:2},[t.slot?{name:"default",fn:i(n=>[b(e.$slots,t.slot,{row:n.row,index:n.index},void 0,!0)]),key:"0"}:t.formatTime?{name:"default",fn:i(n=>[K(O(T(n.row[t.prop],t.formatTime)),1)]),key:"1"}:t.image?{name:"default",fn:i(n=>[n.row[t.image]?(r(),d(j,{key:0,"preview-teleported":"",class:"table-image",src:z(n.row[t.image]),"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[z(n.row[t.image])],"show-progress":"",fit:"cover"},null,8,["src","preview-src-list"])):(r(),m("span",se,"暂无图片"))]),key:"2"}:void 0]),1032,["type","fixed","prop","label","width","min-width","align"]))),128))]),_:3},8,["data","style"])),[[F,y.value]]),E("div",re,[P(U,{"current-page":s.currentPage,"onUpdate:currentPage":a[0]||(a[0]=t=>s.currentPage=t),"page-size":s.pageSize,"onUpdate:pageSize":a[1]||(a[1]=t=>s.pageSize=t),"page-sizes":p.pageSizes,total:f.value,background:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:V,disabled:f.value===0},null,8,["current-page","page-size","page-sizes","total","disabled"])])]),_:3})])}}}),ie=ee(ne,[["__scopeId","data-v-2f15ada9"]]);export{ie as T};
