import{r as B}from"./company-Cx-MsYTh.js";import{d as h,r as q,k as w,l as _,n as D,w as t,a as n,e as a,g as E,v as I,f as b,b as N,h as i,q as R,s as U,_ as F}from"./index-D6YPj1KB.js";const K={class:"user-name"},M=h({__name:"ResetPasswordDialog",props:{visible:{type:Boolean},accountId:{},name:{}},emits:["update:visible","reset-success","reset-fail"],setup(g,{emit:v}){const d=g,p=v,l=q(d.visible),e=w({pwd:"",confirmPassword:""});_(()=>d.visible,s=>{l.value=s}),_(l,s=>{p("update:visible",s)});const V=()=>{m()},P=()=>{l.value=!1,m()},y=async()=>{if(!e.pwd){i.warning("请输入新密码");return}if(e.pwd!==e.confirmPassword){i.warning("两次输入的密码不一致");return}try{let s=await R();e.pwd=U.sm2.doEncrypt(e.pwd,s.data),await B({id:d.accountId,pwd:e.pwd}),i.success("重置成功"),l.value=!1,p("reset-success"),m()}catch(s){console.error("重置密码失败:",s),i.error("密码重置失败，请重试"),p("reset-fail",s)}},m=()=>{e.pwd="",e.confirmPassword=""},C=w({pwd:[{required:!0,message:"请输入密码",trigger:"blur"}],confirmPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}]});return(s,o)=>{const u=n("el-form-item"),c=n("el-input"),x=n("el-form"),f=n("el-button"),k=n("el-dialog");return N(),D(k,{modelValue:l.value,"onUpdate:modelValue":o[2]||(o[2]=r=>l.value=r),title:"重置密码",width:"30%",onClose:V},{footer:t(()=>[a(f,{onClick:P},{default:t(()=>[...o[3]||(o[3]=[b("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:y},{default:t(()=>[...o[4]||(o[4]=[b("确定",-1)])]),_:1})]),default:t(()=>[a(x,{model:e,"label-width":"100px",rules:C},{default:t(()=>[a(u,{label:"用户"},{default:t(()=>[E("span",K,I(d.name),1)]),_:1}),a(u,{label:"新密码",prop:"pwd"},{default:t(()=>[a(c,{modelValue:e.pwd,"onUpdate:modelValue":o[0]||(o[0]=r=>e.pwd=r),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),a(u,{label:"确认密码",prop:"confirmPassword"},{default:t(()=>[a(c,{modelValue:e.confirmPassword,"onUpdate:modelValue":o[1]||(o[1]=r=>e.confirmPassword=r),type:"password",placeholder:"请确认新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}}),j=F(M,[["__scopeId","data-v-8991df75"]]);export{j as R};
